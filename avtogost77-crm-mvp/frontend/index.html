<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ–ì–û–°–¢77 CRM MVP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 30px;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab.active {
            border-bottom-color: #3498db;
            color: #3498db;
        }
        
        .tab:hover {
            background: #f8f9fa;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .table th, .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-new { background: #e3f2fd; color: #1976d2; }
        .status-processing { background: #fff3e0; color: #f57c00; }
        .status-completed { background: #e8f5e8; color: #388e3c; }
        .status-cancelled { background: #ffebee; color: #d32f2f; }
        
        .rating-stars {
            color: #f39c12;
            font-size: 18px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .stat-card p {
            opacity: 0.9;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöõ –ê–≤—Ç–æ–ì–û–°–¢77 CRM MVP</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–º–∏ –∑–∞—è–≤–∫–∞–º–∏ –∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏</p>
        </div>
        
        <div class="content">
            <div class="tabs">
                <div class="tab active" onclick="showTab('dashboard')">üìä –î–∞—à–±–æ—Ä–¥</div>
                <div class="tab" onclick="showTab('leads')">üìã –ó–∞—è–≤–∫–∏</div>
                <div class="tab" onclick="showTab('partners')">ü§ù –ü–∞—Ä—Ç–Ω–µ—Ä—ã</div>
                <div class="tab" onclick="showTab('management')">üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–π —É—á–µ—Ç</div>
            </div>
            
            <!-- –î–∞—à–±–æ—Ä–¥ -->
            <div id="dashboard" class="tab-content active">
                <h2>üìä –î–∞—à–±–æ—Ä–¥</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="total-leads">0</h3>
                        <p>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-partners">0</h3>
                        <p>–ü–∞—Ä—Ç–Ω–µ—Ä–æ–≤</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="total-revenue">0 ‚ÇΩ</h3>
                        <p>–û–±—â–∏–π –¥–æ—Ö–æ–¥</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="avg-margin">0%</h3>
                        <p>–°—Ä–µ–¥–Ω—è—è –º–∞—Ä–∂–∞</p>
                    </div>
                </div>
                
                <div class="alert alert-success">
                    <strong>‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!</strong> Backend API —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç.
                </div>
            </div>
            
            <!-- –ó–∞—è–≤–∫–∏ -->
            <div id="leads" class="tab-content">
                <h2>üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏</h2>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="showCreateLeadForm()">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
                    <button class="btn btn-secondary" onclick="loadLeads()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                
                <div id="create-lead-form" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏</h3>
                    <div class="form-group">
                        <label>–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ *</label>
                        <input type="text" id="client-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞">
                    </div>
                    <div class="form-group">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞ *</label>
                        <input type="tel" id="client-phone" placeholder="+7 (999) 123-45-67">
                    </div>
                    <div class="form-group">
                        <label>Email –∫–ª–∏–µ–Ω—Ç–∞</label>
                        <input type="email" id="client-email" placeholder="client@example.com">
                    </div>
                    <div class="form-group">
                        <label>–ì–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è *</label>
                        <input type="text" id="route-from" placeholder="–ú–æ—Å–∫–≤–∞">
                    </div>
                    <div class="form-group">
                        <label>–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è *</label>
                        <input type="text" id="route-to" placeholder="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞</label>
                        <input type="text" id="cargo-name" placeholder="–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã">
                    </div>
                    <div class="form-group">
                        <label>–í–µ—Å –≥—Ä—É–∑–∞ (–∫–≥)</label>
                        <input type="number" id="cargo-weight" placeholder="1000">
                    </div>
                    <div class="form-group">
                        <label>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
                        <input type="number" id="total-amount" placeholder="25000">
                    </div>
                    <div class="form-group">
                        <label>–ó–∞–º–µ—Ç–∫–∏</label>
                        <textarea id="notes" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="createLead()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                    <button class="btn btn-secondary" onclick="hideCreateLeadForm()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
                
                <div id="leads-table"></div>
            </div>
            
            <!-- –ü–∞—Ä—Ç–Ω–µ—Ä—ã -->
            <div id="partners" class="tab-content">
                <h2>ü§ù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏</h2>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="showCreatePartnerForm()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞</button>
                    <button class="btn btn-secondary" onclick="loadPartners()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                
                <div id="create-partner-form" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞</h3>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ *</label>
                        <input type="text" id="company-name" placeholder="–û–û–û –¢—Ä–∞–Ω—Å–õ–æ–≥–∏—Å—Ç">
                    </div>
                    <div class="form-group">
                        <label>–ò–ù–ù</label>
                        <input type="text" id="inn" placeholder="7701234567">
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
                        <input type="text" id="contact-person" placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò.">
                    </div>
                    <div class="form-group">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="partner-phone" placeholder="+7 (495) 123-45-67">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="partner-email" placeholder="info@company.ru">
                    </div>
                    <div class="form-group">
                        <label>–ó–∞–º–µ—Ç–∫–∏</label>
                        <textarea id="partner-notes" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="createPartner()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞</button>
                    <button class="btn btn-secondary" onclick="hideCreatePartnerForm()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
                
                <div id="partners-table"></div>
            </div>
            
            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–π —É—á–µ—Ç -->
            <div id="management" class="tab-content">
                <h2>üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–π —É—á–µ—Ç</h2>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="showCreateRecordForm()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                    <button class="btn btn-secondary" onclick="loadManagementRecords()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                
                <div id="create-record-form" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ —É—á–µ—Ç–∞</h3>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ *</label>
                        <input type="date" id="operation-date" required>
                    </div>
                    <div class="form-group">
                        <label>–ö–ª–∏–µ–Ω—Ç</label>
                        <input type="text" id="management-client" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞">
                    </div>
                    <div class="form-group">
                        <label>–ü–∞—Ä—Ç–Ω–µ—Ä</label>
                        <input type="text" id="management-partner" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞">
                    </div>
                    <div class="form-group">
                        <label>–í—Ö–æ–¥—è—â–∞—è —Å—É–º–º–∞ (‚ÇΩ) *</label>
                        <input type="number" id="incoming-amount" placeholder="25000" required>
                    </div>
                    <div class="form-group">
                        <label>–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ (‚ÇΩ) *</label>
                        <input type="number" id="partner-cost" placeholder="15000" required>
                    </div>
                    <div class="form-group">
                        <label>–ó–∞–º–µ—Ç–∫–∏</label>
                        <textarea id="management-notes" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="createManagementRecord()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                    <button class="btn btn-secondary" onclick="hideCreateRecordForm()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
                
                <div id="management-table"></div>
            </div>
        </div>
    </div>

    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'leads') loadLeads();
            if (tabName === 'partners') loadPartners();
            if (tabName === 'management') loadManagementRecords();
        }
        
        // –§–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è
        function showCreateLeadForm() {
            document.getElementById('create-lead-form').style.display = 'block';
        }
        
        function hideCreateLeadForm() {
            document.getElementById('create-lead-form').style.display = 'none';
        }
        
        function showCreatePartnerForm() {
            document.getElementById('create-partner-form').style.display = 'block';
        }
        
        function hideCreatePartnerForm() {
            document.getElementById('create-partner-form').style.display = 'none';
        }
        
        function showCreateRecordForm() {
            document.getElementById('create-record-form').style.display = 'block';
        }
        
        function hideCreateRecordForm() {
            document.getElementById('create-record-form').style.display = 'none';
        }
        
        // API —Ñ—É–Ω–∫—Ü–∏–∏
        const API_BASE = 'http://localhost:8000/api/v1';
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫
        async function loadLeads() {
            try {
                const response = await fetch(`${API_BASE}/leads/`);
                const leads = await response.json();
                displayLeads(leads);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫:', error);
                document.getElementById('leads-table').innerHTML = '<div class="alert alert-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫</div>';
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫
        function displayLeads(leads) {
            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ö–ª–∏–µ–Ω—Ç</th>
                            <th>–ú–∞—Ä—à—Ä—É—Ç</th>
                            <th>–ì—Ä—É–∑</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–î–∞—Ç–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${leads.map(lead => `
                            <tr>
                                <td>${lead.id}</td>
                                <td>${lead.client_name}</td>
                                <td>${lead.route_from} ‚Üí ${lead.route_to}</td>
                                <td>${lead.cargo_name || '-'}</td>
                                <td><span class="status-badge status-${lead.status}">${lead.status}</span></td>
                                <td>${lead.total_amount ? lead.total_amount + ' ‚ÇΩ' : '-'}</td>
                                <td>${new Date(lead.created_at).toLocaleDateString('ru-RU')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('leads-table').innerHTML = table;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
        async function createLead() {
            const leadData = {
                client_name: document.getElementById('client-name').value,
                client_phone: document.getElementById('client-phone').value,
                client_email: document.getElementById('client-email').value,
                route_from: document.getElementById('route-from').value,
                route_to: document.getElementById('route-to').value,
                cargo_name: document.getElementById('cargo-name').value,
                cargo_weight: parseFloat(document.getElementById('cargo-weight').value) || null,
                total_amount: parseFloat(document.getElementById('total-amount').value) || null,
                notes: document.getElementById('notes').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/leads/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(leadData)
                });
                
                if (response.ok) {
                    alert('–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
                    hideCreateLeadForm();
                    loadLeads();
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
        async function loadPartners() {
            try {
                const response = await fetch(`${API_BASE}/partners/`);
                const partners = await response.json();
                displayPartners(partners);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤:', error);
                document.getElementById('partners-table').innerHTML = '<div class="alert alert-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</div>';
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
        function displayPartners(partners) {
            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ö–æ–º–ø–∞–Ω–∏—è</th>
                            <th>–ò–ù–ù</th>
                            <th>–ö–æ–Ω—Ç–∞–∫—Ç</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>Email</th>
                            <th>–†–µ–π—Ç–∏–Ω–≥</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${partners.map(partner => `
                            <tr>
                                <td>${partner.id}</td>
                                <td>${partner.company_name}</td>
                                <td>${partner.inn || '-'}</td>
                                <td>${partner.contact_person || '-'}</td>
                                <td>${partner.phone || '-'}</td>
                                <td>${partner.email || '-'}</td>
                                <td>
                                    <span class="rating-stars">
                                        ${'‚òÖ'.repeat(Math.floor(partner.rating || 0))}${'‚òÜ'.repeat(5 - Math.floor(partner.rating || 0))}
                                    </span>
                                    ${partner.rating ? ` (${partner.rating})` : ''}
                                </span>
                                </td>
                                <td><span class="status-badge status-${partner.status}">${partner.status}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('partners-table').innerHTML = table;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
        async function createPartner() {
            const partnerData = {
                company_name: document.getElementById('company-name').value,
                inn: document.getElementById('inn').value,
                contact_person: document.getElementById('contact-person').value,
                phone: document.getElementById('partner-phone').value,
                email: document.getElementById('partner-email').value,
                notes: document.getElementById('partner-notes').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/partners/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(partnerData)
                });
                
                if (response.ok) {
                    alert('–ü–∞—Ä—Ç–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                    hideCreatePartnerForm();
                    loadPartners();
                } else {
                    alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø–∏—Å–µ–π —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ —É—á–µ—Ç–∞
        async function loadManagementRecords() {
            try {
                const response = await fetch(`${API_BASE}/management/`);
                const records = await response.json();
                displayManagementRecords(records);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–µ–π:', error);
                document.getElementById('management-table').innerHTML = '<div class="alert alert-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–µ–π</div>';
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ —É—á–µ—Ç–∞
        function displayManagementRecords(records) {
            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ö–ª–∏–µ–Ω—Ç</th>
                            <th>–ü–∞—Ä—Ç–Ω–µ—Ä</th>
                            <th>–í—Ö–æ–¥—è—â–∞—è —Å—É–º–º–∞</th>
                            <th>–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞</th>
                            <th>EBITDA</th>
                            <th>–ù–∞–ª–æ–≥–∏</th>
                            <th>–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</th>
                            <th>–ú–∞—Ä–∂–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${records.map(record => `
                            <tr>
                                <td>${record.id}</td>
                                <td>${new Date(record.date).toLocaleDateString('ru-RU')}</td>
                                <td>${record.client_name || '-'}</td>
                                <td>${record.partner_name || '-'}</td>
                                <td>${record.incoming_amount} ‚ÇΩ</td>
                                <td>${record.partner_cost} ‚ÇΩ</td>
                                <td>${record.ebitda ? record.ebitda + ' ‚ÇΩ' : '-'}</td>
                                <td>${record.tax_amount ? record.tax_amount + ' ‚ÇΩ' : '-'}</td>
                                <td>${record.net_profit ? record.net_profit + ' ‚ÇΩ' : '-'}</td>
                                <td>${record.margin_percent ? record.margin_percent.toFixed(2) + '%' : '-'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('management-table').innerHTML = table;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ —É—á–µ—Ç–∞
        async function createManagementRecord() {
            const recordData = {
                date: document.getElementById('operation-date').value,
                client_name: document.getElementById('management-client').value,
                partner_name: document.getElementById('management-partner').value,
                incoming_amount: parseFloat(document.getElementById('incoming-amount').value),
                partner_cost: parseFloat(document.getElementById('partner-cost').value),
                notes: document.getElementById('management-notes').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/management/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(recordData)
                });
                
                if (response.ok) {
                    alert('–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!');
                    hideCreateRecordForm();
                    loadManagementRecords();
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º—É
            document.getElementById('operation-date').value = new Date().toISOString().split('T')[0];
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞
            loadDashboardData();
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞
        async function loadDashboardData() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞—è–≤–æ–∫
                const leadsResponse = await fetch(`${API_BASE}/leads/stats/summary`);
                if (leadsResponse.ok) {
                    const leadsStats = await leadsResponse.json();
                    document.getElementById('total-leads').textContent = leadsStats.total_leads || 0;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
                const partnersResponse = await fetch(`${API_BASE}/partners/stats/summary`);
                if (partnersResponse.ok) {
                    const partnersStats = await partnersResponse.json();
                    document.getElementById('total-partners').textContent = partnersStats.total_partners || 0;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ —É—á–µ—Ç–∞
                const managementResponse = await fetch(`${API_BASE}/management/stats/summary`);
                if (managementResponse.ok) {
                    const managementStats = await managementResponse.json();
                    document.getElementById('total-revenue').textContent = (managementStats.total_revenue || 0) + ' ‚ÇΩ';
                    document.getElementById('avg-margin').textContent = (managementStats.average_margin || 0).toFixed(2) + '%';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞:', error);
            }
        }
    </script>
</body>
</html>
