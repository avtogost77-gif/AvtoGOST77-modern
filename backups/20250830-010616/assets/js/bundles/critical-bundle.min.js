/* ===== –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô BUNDLE –î–õ–Ø AVTOGOST77 ===== *//* –í–∫–ª—é—á–∞–µ—Ç: main.js + calculator + UI + mobile */// === MAIN.JS ===// =======================================================// üöõ MAIN.JS - –û–°–ù–û–í–ù–û–ô –°–ö–†–ò–ü–¢ –ê–í–¢–û–ì–û–°–¢// =======================================================// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞let smartCalculatorV2;// ===============================================// –í–û–†–û–ù–ö–ê –ü–†–û–î–ê–ñ - –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –ò –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–û–°–¢–¨// ===============================================// –ê–Ω–∏–º–∞—Ü–∏—è –∂–∏–≤–æ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞function animateActiveUsers() {const counter = document.getElementById('activeUsers');if (!counter) return;const minUsers = 3;const maxUsers = 12;setInterval(() => {const currentValue = parseInt(counter.textContent);const change = Math.random() > 0.7 ? (Math.random() > 0.5 ? 1 : -1) : 0;let newValue = currentValue + change;// –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–ΩnewValue = Math.max(minUsers, Math.min(maxUsers, newValue));if (newValue !== currentValue) {counter.style.transform = 'scale(1.1)';setTimeout(() => {counter.textContent = newValue;counter.style.transform = 'scale(1)';}, 150);}}, Math.random() * 10000 + 5000); // 5-15 —Å–µ–∫—É–Ω–¥}// –°—Ä–æ—á–Ω—ã–π –∑–∞–∫–∞–∑function openUrgentModal() {const modal = createModal('urgent', {title: '‚ö° –°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∑–∞ 2 —á–∞—Å–∞',subtitle: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –∏ –º—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –º–∏–Ω—É—Ç',fields: [{ name: 'urgentName', type: 'text', placeholder: '–í–∞—à–µ –∏–º—è', required: true },{ name: 'urgentPhone', type: 'tel', placeholder: '+7 (999) 123-45-67', required: true },{ name: 'urgentFrom', type: 'text', placeholder: '–û—Ç–∫—É–¥–∞ –∑–∞–±—Ä–∞—Ç—å –≥—Ä—É–∑', required: true },{ name: 'urgentTo', type: 'text', placeholder: '–ö—É–¥–∞ –¥–æ—Å—Ç–∞–≤–∏—Ç—å', required: true },{ name: 'urgentCargo', type: 'text', placeholder: '–û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–∑–∞', required: true }],buttonText: '–ó–∞–∫–∞–∑–∞—Ç—å —Å—Ä–æ—á–Ω–æ',source: 'urgent-delivery'});}// –ê—É–¥–∏—Ç —ç–∫–æ–Ω–æ–º–∏–∏function openSavingsModal() {const modal = createModal('savings', {title: 'üí∞ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞—É–¥–∏—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤',subtitle: '–£–∑–Ω–∞–π—Ç–µ, —Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ–ø–ª–∞—á–∏–≤–∞–µ—Ç–µ –∑–∞ –ª–æ–≥–∏—Å—Ç–∏–∫—É',fields: [{ name: 'savingsName', type: 'text', placeholder: '–í–∞—à–µ –∏–º—è', required: true },{ name: 'savingsPhone', type: 'tel', placeholder: '+7 (999) 123-45-67', required: true },{ name: 'savingsCompany', type: 'text', placeholder: '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏', required: true },{ name: 'savingsMonthlySpend', type: 'number', placeholder: '–¢—Ä–∞—Ç–∏—Ç–µ –Ω–∞ –ª–æ–≥–∏—Å—Ç–∏–∫—É –≤ –º–µ—Å—è—Ü (‚ÇΩ)', required: true },{ name: 'savingsRoutes', type: 'text', placeholder: '–û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã', required: false }],buttonText: '–ü–æ–ª—É—á–∏—Ç—å –∞—É–¥–∏—Ç',source: 'savings-audit',extraInfo: '–ê—É–¥–∏—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤'});}// –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—èfunction openConsultationModal() {const modal = createModal('consultation', {title: 'ü§ù –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞',subtitle: '15 –º–∏–Ω—É—Ç —Å —ç–∫—Å–ø–µ—Ä—Ç–æ–º –ø–æ –ª–æ–≥–∏—Å—Ç–∏–∫–µ',fields: [{ name: 'consultName', type: 'text', placeholder: '–í–∞—à–µ –∏–º—è', required: true },{ name: 'consultPhone', type: 'tel', placeholder: '+7 (999) 123-45-67', required: true },{ name: 'consultEmail', type: 'email', placeholder: 'email@company.ru', required: false },{ name: 'consultTopic', type: 'select', placeholder: '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É', options: ['–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤','–í—ã–±–æ—Ä –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫–∞', '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Å—Ç–∏–∫–∏','–°—Ä–æ—á–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏','–î—Ä—É–≥–æ–µ'], required: true },{ name: 'consultTime', type: 'select', placeholder: '–£–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è', options: ['–°–µ–≥–æ–¥–Ω—è –¥–æ 18:00','–ó–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º','–ó–∞–≤—Ç—Ä–∞ –≤–µ—á–µ—Ä–æ–º','–í —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏'], required: true }],buttonText: '–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é',source: 'consultation',extraInfo: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ'});}// –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µfunction openComparisonModal() {const modal = createModal('comparison', {title: 'üìä –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –ö–ü',subtitle: '–ü–æ–ª—É—á–∏—Ç–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞',fields: [{ name: 'companyName', type: 'text', placeholder: '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏', required: true },{ name: 'contactName', type: 'text', placeholder: '–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ', required: true },{ name: 'contactPhone', type: 'tel', placeholder: '+7 (999) 123-45-67', required: true },{ name: 'contactEmail', type: 'email', placeholder: 'email@company.ru', required: true },{ name: 'cargoTypes', type: 'text', placeholder: '–¢–∏–ø—ã –≥—Ä—É–∑–æ–≤', required: true },{ name: 'monthlyVolume', type: 'text', placeholder: '–û–±—ä–µ–º –ø–µ—Ä–µ–≤–æ–∑–æ–∫ –≤ –º–µ—Å—è—Ü', required: true },{ name: 'currentProvider', type: 'text', placeholder: '–¢–µ–∫—É—â–∏–π –ø–µ—Ä–µ–≤–æ–∑—á–∏–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)', required: false }],buttonText: '–ü–æ–ª—É—á–∏—Ç—å –ö–ü',source: 'commercial-offer',extraInfo: '–ö–ü –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤'});}// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞function createModal(type, config) {// –°–æ–∑–¥–∞–µ–º HTML –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞const modalHTML = `<div class="modal-overlay" id="modal-${type}"><div class="modal-content"><div class="modal-header"><h3>${config.title}</h3><button class="modal-close" onclick="closeModal('${type}')">&times;</button></div><div class="modal-body"><p class="modal-subtitle">${config.subtitle}</p><form class="modal-form" onsubmit="submitModal(event, '${type}', '${config.source}')">${config.fields.map(field => {if (field.type === 'select') {return `<div class="form-group"><select name="${field.name}" ${field.required ? 'required' : ''}><option value="">${field.placeholder}</option>${field.options.map(option => `<option value="${option}">${option}</option>`).join('')}</select></div>`;} else {return `<div class="form-group"><input type="${field.type}" name="${field.name}" placeholder="${field.placeholder}" ${field.required ? 'required' : ''}></div>`;}}).join('')}${config.extraInfo ? `<p class="modal-info">${config.extraInfo}</p>` : ''}<button type="submit" class="btn btn-primary btn-lg">${config.buttonText}</button></form></div></div></div>`;// –î–æ–±–∞–≤–ª—è–µ–º –≤ DOMdocument.body.insertAdjacentHTML('beforeend', modalHTML);// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æconst modal = document.getElementById(`modal-${type}`);modal.style.display = 'flex';document.body.style.overflow = 'hidden';// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlaymodal.addEventListener('click', (e) => {if (e.target === modal) {closeModal(type);}});return modal;}// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞function closeModal(type) {const modal = document.getElementById(`modal-${type}`);if (modal) {modal.remove();document.body.style.overflow = '';}}// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞async function submitModal(event, type, source) {event.preventDefault();const form = event.target;const formData = new FormData(form);const data = Object.fromEntries(formData.entries());// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—Éconst button = form.querySelector('button[type="submit"]');const originalText = button.textContent;button.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';button.disabled = true;try {// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegramconst success = await sendToTelegram({...data,source: source,timestamp: new Date().toLocaleString('ru-RU')});if (success) {// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Öform.innerHTML = `<div class="success-message"><div class="success-icon">‚úÖ</div><h4>–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h4><p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç</p><button class="btn btn-outline" onclick="closeModal('${type}')">–ó–∞–∫—Ä—ã—Ç—å</button></div>`;// –ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥setTimeout(() => closeModal(type), 5000);} else {throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');}} catch (error) {button.textContent = '–û—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑';button.disabled = false;setTimeout(() => {button.textContent = originalText;}, 2000);}}// CSS —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ωconst modalStyles = `.modal-overlay {position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: rgba(0, 0, 0, 0.8);display: flex;justify-content: center;align-items: center;z-index: 10000;backdrop-filter: blur(4px);}.modal-content {background: white;border-radius: 16px;max-width: 500px;width: 90%;max-height: 90vh;overflow-y: auto;box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);}.modal-header {display: flex;justify-content: space-between;align-items: center;padding: 2rem 2rem 0;}.modal-header h3 {margin: 0;font-size: 1.5rem;color: var(--neutral-900);}.modal-close {background: none;border: none;font-size: 2rem;cursor: pointer;color: var(--neutral-500);padding: 0;width: 2rem;height: 2rem;display: flex;align-items: center;justify-content: center;}.modal-body {padding: 2rem;}.modal-subtitle {color: var(--neutral-600);margin-bottom: 1.5rem;}.modal-form .form-group {margin-bottom: 1rem;}.modal-form input,.modal-form select {width: 100%;padding: 0.75rem;border: 2px solid var(--neutral-200);border-radius: 8px;font-size: 1rem;transition: border-color var(--transition-fast);}.modal-form input:focus,.modal-form select:focus {outline: none;border-color: var(--primary-500);}.modal-info {font-size: 0.875rem;color: var(--neutral-600);background: var(--neutral-50);padding: 1rem;border-radius: 8px;margin: 1rem 0;}.success-message {text-align: center;padding: 2rem;}.success-icon {font-size: 3rem;margin-bottom: 1rem;}.success-message h4 {color: var(--success);margin-bottom: 1rem;}`;// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏if (!document.getElementById('modal-styles')) {const styleSheet = document.createElement('style');styleSheet.id = 'modal-styles';styleSheet.textContent = modalStyles;document.head.appendChild(styleSheet);}// ========================================================// üéØ EXIT-INTENT POPUP SYSTEM V2.0// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤// ========================================================let exitIntentShown = false;// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è exit-intent —Å–∏—Å—Ç–µ–º—ãfunction initExitIntent() {// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –ª–∏ —É–∂–µ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏if (sessionStorage.getItem('exitIntentShown') === 'true') {exitIntentShown = true;return;}// –ú–û–ë–ò–õ–¨–ù–´–ï –£–°–¢–†–û–ô–°–¢–í–ê - –¥—Ä—É–≥–∞—è –ª–æ–≥–∏–∫–∞const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;if (isMobile) {// –ú–û–ë–ò–õ–¨–ù–´–ï: –ú–∏–Ω–∏–º—É–º 2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ãlet isEarlySession = true;setTimeout(() => {isEarlySession = false;}, 120000); // 2 –º–∏–Ω—É—Ç—ã// –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –≤–≤–µ—Ä—Ö –∏–ª–∏ –¥–æ–ª–≥–æ–º –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–∏let lastScrollY = window.scrollY;let scrollUpCount = 0;window.addEventListener('scroll', () => {const currentScrollY = window.scrollY;// –ï—Å–ª–∏ —Å–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –∏ –Ω–∞—Ö–æ–¥–∏–º—Å—è –Ω–µ –≤ —Å–∞–º–æ–º –≤–µ—Ä—Ö—Éif (currentScrollY < lastScrollY && currentScrollY > 200) {scrollUpCount++;// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ 5—Ö —Å–∫—Ä–æ–ª–ª–æ–≤ –≤–≤–µ—Ä—Ö (–±–æ–ª—å—à–µ —Ç–µ—Ä–ø–µ–Ω–∏—è)if (scrollUpCount >= 5 && !exitIntentShown && !isEarlySession) {// showExitIntentPopup(); // –û–¢–ö–õ–Æ–ß–ï–ù–û}} else {scrollUpCount = Math.max(0, scrollUpCount - 1);}lastScrollY = currentScrollY;});// –î–æ–ª–≥–æ–µ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (10 –º–∏–Ω—É—Ç)setTimeout(() => {if (!exitIntentShown && !isEarlySession) {// showExitIntentPopup(); // –û–¢–ö–õ–Æ–ß–ï–ù–û}}, 600000); // 10 –º–∏–Ω—É—Ç} else {// –î–ï–°–ö–¢–û–ü - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã// –î–ï–°–ö–¢–û–ü: –ú–∏–Ω–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ãlet isEarlyDesktopSession = true;setTimeout(() => {isEarlyDesktopSession = false;}, 30000); // 30 —Å–µ–∫—É–Ω–¥// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏ –¥–ª—è desktopdocument.addEventListener('mouseleave', function(e) {// –ï—Å–ª–∏ –º—ã—à—å —É—à–ª–∞ –∑–∞ –≤–µ—Ä—Ö–Ω–∏–π –∫—Ä–∞–π —ç–∫—Ä–∞–Ω–∞ (–∫ –∑–∞–∫—Ä—ã—Ç–∏—é/–∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ)if (e.clientY <= 0 && !exitIntentShown && !isEarlyDesktopSession) {// showExitIntentPopup(); // –û–¢–ö–õ–Æ–ß–ï–ù–û}});// –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É (—Ç–æ–ª—å–∫–æ desktop)window.addEventListener('beforeunload', function(e) {if (!exitIntentShown && !isEarlyDesktopSession) {// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º popup (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ)// showExitIntentPopup(); // –û–¢–ö–õ–Æ–ß–ï–ù–û}});// –ë–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ desktop (5 –º–∏–Ω—É—Ç)let inactivityTimer = setTimeout(() => {if (!exitIntentShown && !isEarlyDesktopSession) {// showExitIntentPopup(); // –û–¢–ö–õ–Æ–ß–ï–ù–û}}, 300000); // 5 –º–∏–Ω—É—Ç// –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏document.addEventListener('mousemove', () => {clearTimeout(inactivityTimer);inactivityTimer = setTimeout(() => {if (!exitIntentShown && !isEarlyDesktopSession) {// showExitIntentPopup(); // –û–¢–ö–õ–Æ–ß–ï–ù–û}}, 300000); // 5 –º–∏–Ω—É—Ç});}}// –ü–æ–∫–∞–∑–∞—Ç—å exit-intent popupfunction showExitIntentPopup() {if (exitIntentShown) return;exitIntentShown = true;sessionStorage.setItem('exitIntentShown', 'true');// –ù–∞—Ö–æ–¥–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π popup –≤ HTMLconst popup = document.getElementById('exitIntentPopup');if (!popup) {return;}// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –∞–Ω–∏–º–∞—Ü–∏–µ–πpopup.style.display = 'flex';setTimeout(() => {popup.classList.add('show');}, 10);// –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞startExitCountdown();// –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–πanimateExitProof();}// –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è popupwindow.closeExitPopup = function() {const popup = document.getElementById('exitIntentPopup');if (popup) {popup.classList.remove('show');setTimeout(() => {popup.style.display = 'none';}, 300);}};// –°–æ–∑–¥–∞–Ω–∏–µ exit-intent popupfunction createExitIntentPopup(discount) {const popupHTML = `<div class="exit-intent-overlay" id="exitIntentPopup"><div class="exit-intent-content"><div class="exit-intent-header"><div class="exit-emoji">üõë</div><h3>–ü–æ–¥–æ–∂–¥–∏—Ç–µ! –ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h3><button class="exit-close" onclick="closeExitIntent()">&times;</button></div><div class="exit-intent-body"><div class="discount-badge"><span class="discount-percent">${discount}%</span><span class="discount-text">–°–ö–ò–î–ö–ê</span></div><h4>–ü–æ–ª—É—á–∏—Ç–µ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–æ —Å–∫–∏–¥–∫–æ–π ${discount}%</h4><p>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å!</p><div class="urgency-timer-exit"><span class="timer-text">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑:</span><div class="countdown" id="exitCountdown"><span id="exitMinutes">14</span>:<span id="exitSeconds">59</span></div></div><form class="exit-form" onsubmit="submitExitForm(event, ${discount})"><input type="text" name="exitName" placeholder="–í–∞—à–µ –∏–º—è" required><input type="tel" name="exitPhone" placeholder="+7 (999) 123-45-67" required><input type="text" name="exitRoute" placeholder="–ú–∞—Ä—à—Ä—É—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞ - –°–ü–±)" required><button type="submit" class="btn btn-success btn-lg exit-btn">üéØ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Å–æ —Å–∫–∏–¥–∫–æ–π ${discount}%</button><p class="exit-guarantee">‚úÖ –†–∞—Å—á–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç<br>‚úÖ –ë–µ–∑ —Å–∫—Ä—ã—Ç—ã—Ö –¥–æ–ø–ª–∞—Ç<br>‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥: <strong>EXIT${discount}</strong></p></form><div class="exit-social-proof"><span class="proof-text">üî• –£–∂–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å:</span><span class="proof-count" id="exitProofCount">127</span><span class="proof-label">—á–µ–ª–æ–≤–µ–∫ —Å–µ–≥–æ–¥–Ω—è</span></div></div></div></div>`;document.body.insertAdjacentHTML('beforeend', popupHTML);const popup = document.getElementById('exitIntentPopup');// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlaypopup.addEventListener('click', (e) => {if (e.target === popup) {closeExitIntent();}});// –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞startExitCountdown();// –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–πanimateExitProof();return popup;}// –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –≤ exit popupfunction startExitCountdown() {let totalSeconds = 15 * 60 - 1; // 14:59const countdown = setInterval(() => {const minutes = Math.floor(totalSeconds / 60);const seconds = totalSeconds % 60;const minutesEl = document.getElementById('exitMinutes');const secondsEl = document.getElementById('exitSeconds');if (minutesEl && secondsEl) {minutesEl.textContent = minutes.toString().padStart(2, '0');secondsEl.textContent = seconds.toString().padStart(2, '0');// –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –∫–æ–≥–¥–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –º–∞–ª–æ –≤—Ä–µ–º–µ–Ω–∏if (totalSeconds <= 60) {const countdownEl = document.getElementById('exitCountdown');if (countdownEl) {countdownEl.classList.add('urgent');}}} else {// –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—ÄclearInterval(countdown);return;}totalSeconds--;if (totalSeconds < 0) {clearInterval(countdown);// –í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æif (minutesEl && secondsEl) {minutesEl.textContent = '00';secondsEl.textContent = '00';}}}, 1000);return countdown;}// –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ "–≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Å–µ–≥–æ–¥–Ω—è"function animateExitProof() {const counter = document.getElementById('exitProofCount');if (!counter) return;// –°–ª—É—á–∞–π–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–∞–∂–¥—ã–µ 10-30 —Å–µ–∫—É–Ω–¥setInterval(() => {const current = parseInt(counter.textContent) || 23;const increase = Math.floor(Math.random() * 3) + 1; // +1-3counter.textContent = current + increase;// –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—ècounter.style.transform = 'scale(1.2)';counter.style.color = '#10b981';setTimeout(() => {counter.style.transform = 'scale(1)';counter.style.color = '#10b981';}, 200);}, Math.random() * 20000 + 10000); // 10-30 —Å–µ–∫—É–Ω–¥}// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã exit-intentasync function submitExitForm(event, discount) {event.preventDefault();const form = event.target;const formData = new FormData(form);const data = Object.fromEntries(formData.entries());const button = form.querySelector('button[type="submit"]');const originalText = button.innerHTML;button.innerHTML = 'üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';button.disabled = true;try {const success = await sendToTelegram({...data,source: 'exit-intent',discount: `${discount}%`,promoCode: `EXIT${discount}`,timestamp: new Date().toLocaleString('ru-RU')});if (success) {// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Öform.innerHTML = `<div class="exit-success"><div class="success-icon">üéâ</div><h4>–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!</h4><p>–í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥: <strong>EXIT${discount}</strong></p><p>–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç</p><div class="success-actions"><a href="https://wa.me/79162720932" class="btn btn-whatsapp btn-sm" target="_blank">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp</a><button class="btn btn-outline btn-sm" onclick="closeExitIntent()">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>`;// –ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥setTimeout(() => {closeExitIntent();}, 10000);} else {throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');}} catch (error) {button.innerHTML = '‚ùå –û—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑';button.disabled = false;setTimeout(() => {button.innerHTML = originalText;}, 3000);}}// –ó–∞–∫—Ä—ã—Ç–∏–µ exit-intent popupfunction closeExitIntent() {const popup = document.getElementById('exitIntentPopup');if (popup) {popup.classList.add('hiding');setTimeout(() => {popup.remove();}, 300);}}// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ãdocument.addEventListener('DOMContentLoaded', function() {// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞initCalculator();// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω—éinitMobileMenu();// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–≤–∞—é—â–∏—Ö –∫–Ω–æ–ø–æ–∫initFloatingButtons();// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–ºinitForms();// –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å—á–µ—Ç—á–∏–∫–∞animateActiveUsers();// –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —Å–ª–æ—Ç–æ–≤ (—É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10-20 –º–∏–Ω—É—Ç)const slotsCounter = document.querySelector('.slots-counter');if (slotsCounter) {setInterval(() => {const current = parseInt(slotsCounter.textContent);if (current > 1 && Math.random() > 0.8) {slotsCounter.textContent = current - 1;slotsCounter.style.animation = 'none';setTimeout(() => {slotsCounter.style.animation = 'pulse-red 2s infinite';}, 100);}}, Math.random() * 600000 + 600000); // 10-20 –º–∏–Ω—É—Ç}// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è exit-intent// initExitIntent(); // –û–¢–ö–õ–Æ–ß–ï–ù–û - –ø–æ–ø–∞–ø —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç});// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞function initCalculator() {try {if (typeof SmartCalculatorV2 !== 'undefined') {smartCalculatorV2 = new SmartCalculatorV2();window.smartCalculatorV2 = smartCalculatorV2; // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø} else {// –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—ÉsetTimeout(initCalculator, 1000);}} catch (error) {}}// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–ºfunction initForms() {// –§–æ—Ä–º–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞const calcForm = document.getElementById('calculatorForm');if (calcForm) {calcForm.addEventListener('submit', function(e) {e.preventDefault();handleCalculation();});}// –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –ø–æ IDconst calcButton = document.getElementById('calculateButton');if (calcButton) {calcButton.addEventListener('click', function(e) {e.preventDefault();handleCalculation();});} else {}// –†–µ–∑–µ—Ä–≤–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö onclickconst oldButton = document.querySelector('button[onclick*="handleCalculation"]');if (oldButton) {oldButton.addEventListener('click', function(e) {e.preventDefault();handleCalculation();});}}// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞function handleCalculation() {if (smartCalculatorV2 && typeof smartCalculatorV2.handleCalculation === 'function') {try {smartCalculatorV2.handleCalculation();} catch (error) {alert('–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞: ' + error.message);}} else {alert('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É');// –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏setTimeout(() => {initCalculator();setTimeout(handleCalculation, 500);}, 1000);}}// –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—éfunction initMobileMenu() {const mobileMenuToggle = document.getElementById('mobileMenuToggle');const mobileNav = document.getElementById('mobileNav');if (mobileMenuToggle && mobileNav) {mobileMenuToggle.addEventListener('click', function() {mobileNav.classList.toggle('active');mobileMenuToggle.classList.toggle('active');});}}// –ü–ª–∞–≤–∞—é—â–∏–µ –∫–Ω–æ–ø–∫–∏function initFloatingButtons() {// –ö–Ω–æ–ø–∫–∏ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤ HTML}// –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —è–∫–æ—Ä—è–ºdocument.querySelectorAll('a[href^="#"]').forEach(anchor => {anchor.addEventListener('click', function (e) {e.preventDefault();const target = document.querySelector(this.getAttribute('href'));if (target) {target.scrollIntoView({behavior: 'smooth',block: 'start'});}});});// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏—è–ºwindow.smartCalculatorV2 = smartCalculatorV2;window.handleCalculation = handleCalculation;// === CALCULATOR UI ===// ===============================================// –°–û–í–†–ï–ú–ï–ù–ù–´–ô –ò–ù–¢–ï–†–§–ï–ô–° –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê// ===============================================class CalculatorUI {constructor() {this.currentStep = 1;this.totalSteps = 3;this.init();}init() {this.bindEvents();this.updateProgress();}bindEvents() {// –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —à–∞–≥–∞–ºdocument.getElementById('nextStep1')?.addEventListener('click', () => this.nextStep());document.getElementById('nextStep2')?.addEventListener('click', () => this.nextStep());document.getElementById('prevStep2')?.addEventListener('click', () => this.prevStep());document.getElementById('prevStep3')?.addEventListener('click', () => this.prevStep());// –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—á–µ—Ç–∞document.getElementById('calculateButton')?.addEventListener('click', () => this.calculate());// –ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Çdocument.getElementById('newCalculation')?.addEventListener('click', () => this.resetCalculator());// –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–πthis.setupFieldValidation();}nextStep() {if (this.validateCurrentStep()) {this.currentStep = Math.min(this.currentStep + 1, this.totalSteps);this.updateUI();}}prevStep() {this.currentStep = Math.max(this.currentStep - 1, 1);this.updateUI();}validateCurrentStep() {switch (this.currentStep) {case 1:return this.validateRoute();case 2:return this.validateCargo();default:return true;}}validateRoute() {const fromCity = document.getElementById('fromCity').value.trim();const toCity = document.getElementById('toCity').value.trim();if (!fromCity) {this.showError('fromCity', '–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è');return false;}if (!toCity) {this.showError('toCity', '–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è');return false;}if (fromCity.toLowerCase() === toCity.toLowerCase()) {this.showError('toCity', '–ì–æ—Ä–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –º–æ–≥—É—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å');return false;}this.clearErrors();return true;}validateCargo() {const weight = document.getElementById('weight').value;if (!weight || weight <= 0) {this.showError('weight', '–£–∫–∞–∂–∏—Ç–µ –≤–µ—Å –≥—Ä—É–∑–∞');return false;}if (weight > 20000) {this.showError('weight', '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å: 20 —Ç–æ–Ω–Ω. –î–ª—è –±–æ–ª—å—à–∏—Ö –≥—Ä—É–∑–æ–≤ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º');return false;}this.clearErrors();return true;}showError(fieldId, message) {const field = document.getElementById(fieldId);const errorDiv = document.createElement('div');errorDiv.className = 'field-error';errorDiv.textContent = message;errorDiv.style.cssText = 'color: #dc2626; font-size: 0.875rem; margin-top: 0.25rem;';// –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –æ—à–∏–±–∫—Éconst existingError = field.parentNode.querySelector('.field-error');if (existingError) {existingError.remove();}field.parentNode.appendChild(errorDiv);field.style.borderColor = '#dc2626';// –ê–Ω–∏–º–∞—Ü–∏—è –æ—à–∏–±–∫–∏field.style.animation = 'shake 0.5s ease-in-out';setTimeout(() => {field.style.animation = '';}, 500);}clearErrors() {document.querySelectorAll('.field-error').forEach(error => error.remove());document.querySelectorAll('.form-control').forEach(field => {field.style.borderColor = '#e5e7eb';});}updateUI() {// –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–≥–∏document.querySelectorAll('.calc-step').forEach((step, index) => {step.classList.toggle('active', index + 1 === this.currentStep);});// –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Ådocument.querySelectorAll('.progress-step').forEach((step, index) => {const stepNumber = index + 1;step.classList.remove('active', 'completed');if (stepNumber < this.currentStep) {step.classList.add('completed');} else if (stepNumber === this.currentStep) {step.classList.add('active');}});this.updateProgress();// –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏this.updateButtons();}updateProgress() {const progress = ((this.currentStep - 1) / (this.totalSteps - 1)) * 100;const progressFill = document.getElementById('progressFill');if (progressFill) {progressFill.style.width = `${progress}%`;}}updateButtons() {// –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å—á–µ—Ç–∞const calculateBtn = document.getElementById('calculateButton');if (calculateBtn) {const btnText = calculateBtn.querySelector('.btn-text');if (btnText) {btnText.textContent = '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å';}}}async calculate() {const calculateBtn = document.getElementById('calculateButton');const btnText = calculateBtn.querySelector('.btn-text');const btnLoading = calculateBtn.querySelector('.btn-loading');// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—ÉbtnText.style.display = 'none';btnLoading.style.display = 'inline-flex';calculateBtn.disabled = true;try {// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ãconst formData = this.getFormData();// –í—ã–∑—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Äif (window.calculator) {const result = await window.calculator.calculatePrice(formData);this.showResult(result);} else {throw new Error('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');}} catch (error) {this.showError('calculateButton', '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');} finally {// –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—ÉbtnText.style.display = 'inline';btnLoading.style.display = 'none';calculateBtn.disabled = false;}}getFormData() {return {from: document.getElementById('fromCity').value.trim(),to: document.getElementById('toCity').value.trim(),weight: parseFloat(document.getElementById('weight').value) || 0,volume: parseFloat(document.getElementById('volume').value) || 0,isConsolidated: document.getElementById('isConsolidated').checked};}showResult(result) {const resultContainer = document.getElementById('calculatorResult');const resultPrice = document.getElementById('resultPrice');const resultSubtitle = document.getElementById('resultSubtitle');const resultDetails = document.getElementById('resultDetails');// –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ÉresultPrice.textContent = this.formatPrice(result.price);// –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫const route = `${result.from} ‚Üí ${result.to}`;resultSubtitle.textContent = `${route} ‚Ä¢ ${result.weight} –∫–≥`;// –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏resultDetails.innerHTML = this.generateResultDetails(result);// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—ÇresultContainer.classList.add('show');// –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ÉresultContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—èresultContainer.style.animation = 'fadeInScale 0.4s ease-out';}formatPrice(price) {return new Intl.NumberFormat('ru-RU', {style: 'currency',currency: 'RUB',minimumFractionDigits: 0,maximumFractionDigits: 0}).format(price);}generateResultDetails(result) {const details = [];if (result.transport) {details.push(`<div class="detail-item"><div class="detail-label">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</div><div class="detail-value">${result.transport}</div></div>`);}if (result.distance) {details.push(`<div class="detail-item"><div class="detail-label">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ</div><div class="detail-value">${result.distance} –∫–º</div></div>`);}if (result.deliveryTime) {details.push(`<div class="detail-item"><div class="detail-label">–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏</div><div class="detail-value">${result.deliveryTime}</div></div>`);}if (result.pricePerKm) {details.push(`<div class="detail-item"><div class="detail-label">–¢–∞—Ä–∏—Ñ –∑–∞ –∫–º</div><div class="detail-value">${result.pricePerKm} ‚ÇΩ/–∫–º</div></div>`);}return details.join('');}resetCalculator() {// –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—Édocument.getElementById('calculatorForm').reset();// –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Çdocument.getElementById('calculatorResult').classList.remove('show');// –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É —à–∞–≥—Éthis.currentStep = 1;this.updateUI();// –û—á–∏—â–∞–µ–º –æ—à–∏–±–∫–∏this.clearErrors();// –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞document.getElementById('calculator').scrollIntoView({ behavior: 'smooth' });}setupFieldValidation() {// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µconst fields = ['fromCity', 'toCity', 'weight'];fields.forEach(fieldId => {const field = document.getElementById(fieldId);if (field) {field.addEventListener('input', () => {const error = field.parentNode.querySelector('.field-error');if (error) {error.remove();field.style.borderColor = '#e5e7eb';}});}});}}// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ãdocument.addEventListener('DOMContentLoaded', function() {// –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞setTimeout(() => {window.calculatorUI = new CalculatorUI();}, 100);});// CSS –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –æ—à–∏–±–æ–∫const style = document.createElement('style');style.textContent = `@keyframes shake {0%, 100% { transform: translateX(0); }25% { transform: translateX(-5px); }75% { transform: translateX(5px); }}`;document.head.appendChild(style);// === MOBILE COLLAPSE ===// Mobile Collapse Functionality// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ–∫—Ü–∏–π —Å data-collapse="mobile"document.addEventListener('DOMContentLoaded', function() {// –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏ —Å data-collapse="mobile"const collapsibleSections = document.querySelectorAll('[data-collapse="mobile"]');collapsibleSections.forEach(section => {// –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—åconst toggle = document.createElement('button');toggle.className = 'mobile-toggle';toggle.setAttribute('aria-label', '–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Å–µ–∫—Ü–∏—é');// –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏const sectionTitle = section.querySelector('h2, h3, h4') ||  section.querySelector('.section-title') || section.getAttribute('data-title') || '–ü–æ–¥—Ä–æ–±–Ω–µ–µ';toggle.textContent = sectionTitle.textContent || sectionTitle;// –í—Å—Ç–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–¥ —Å–µ–∫—Ü–∏–µ–πsection.parentNode.insertBefore(toggle, section);// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞toggle.addEventListener('click', function() {const isExpanded = section.classList.contains('expanded');if (isExpanded) {// –°–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—ésection.classList.remove('expanded');toggle.classList.remove('expanded');toggle.setAttribute('aria-expanded', 'false');} else {// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—ésection.classList.add('expanded');toggle.classList.add('expanded');toggle.setAttribute('aria-expanded', 'true');// –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—èsection.style.display = 'block';section.style.opacity = '0';section.style.transform = 'translateY(-10px)';setTimeout(() => {section.style.transition = 'opacity 0.3s ease, transform 0.3s ease';section.style.opacity = '1';section.style.transform = 'translateY(0)';}, 10);}});// –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏function handleResize() {if (window.innerWidth > 768) {section.style.display = 'block';section.style.opacity = '1';section.style.transform = 'none';toggle.style.display = 'none';} else {if (!section.classList.contains('expanded')) {section.style.display = 'none';}toggle.style.display = 'flex';}}// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µhandleResize();// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞window.addEventListener('resize', handleResize);});// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UXconst mobileToggles = document.querySelectorAll('.mobile-toggle');// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ãmobileToggles.forEach(toggle => {toggle.addEventListener('keydown', function(e) {if (e.key === 'Enter' || e.key === ' ') {e.preventDefault();toggle.click();}});});// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ —Å–µ–∫—Ü–∏–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —è–∫–æ—Ä—éif (window.location.hash) {const targetSection = document.querySelector(window.location.hash);if (targetSection && targetSection.hasAttribute('data-collapse')) {const toggle = targetSection.previousElementSibling;if (toggle && toggle.classList.contains('mobile-toggle')) {setTimeout(() => {toggle.click();targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });}, 100);}}}});// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Öwindow.MobileCollapse = {init: function() {// –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏this.handleResize();},handleResize: function() {const collapsibleSections = document.querySelectorAll('[data-collapse="mobile"]');const mobileToggles = document.querySelectorAll('.mobile-toggle');collapsibleSections.forEach(section => {if (window.innerWidth > 768) {section.style.display = 'block';section.style.opacity = '1';section.style.transform = 'none';}});mobileToggles.forEach(toggle => {if (window.innerWidth > 768) {toggle.style.display = 'none';} else {toggle.style.display = 'flex';}});}};// === SMART CALCULATOR V2 ===// ========================================================// üöõ –£–ú–ù–´–ô –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –ê–í–¢–û–ì–û–°–¢ V2.0 - –õ–û–ì–ò–ö–ê –ò–õ–Æ–®–ò// –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ CALCULATOR-LOGIC.md// ========================================================class SmartCalculatorV2 {constructor() {// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º API –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–πthis.distanceAPI = new DistanceAPI();// –¢–ò–ü–´ –¢–†–ê–ù–°–ü–û–†–¢–ê —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –æ—Ç –ò–ª—é—à–∏this.transportTypes = {gazelle: {name: '–ì–∞–∑–µ–ª—å',maxWeight: 1500,// –∫–≥ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!)maxVolume: 16,// –º¬≥density: 94,// –∫–≥/–º¬≥ (1500/16)minPrice: 10000,// –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ú–æ—Å–∫–≤–∞minPriceRegion: 7500, // –º–∏–Ω–∏–º–∞–ª–∫–∞ –≤ —Ä–µ–≥–∏–æ–Ω–∞—Öcoefficient: 1.0, // –ì–ê–ó–ï–õ–¨ –±–∞–∑–æ–≤–∞—è (–±—ã–ª–æ 0.8)allowConsolidated: true,icon: 'üöê'},threeTon: {name: '3-—Ç–æ–Ω–Ω–∏–∫',maxWeight: 3000,maxVolume: 18,density: 167,minPrice: 13000,minPriceRegion: 9750,coefficient: 1.0, // –¢–†–ï–®–ö–ê 25–∫ (–±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ 25‚ÇΩ/–∫–º)allowConsolidated: true,icon: 'üöõ'},fiveTon: {name: '5-—Ç–æ–Ω–Ω–∏–∫',maxWeight: 5000,maxVolume: 36,density: 139,minPrice: 20000,minPriceRegion: 15000,coefficient: 1.05,// –ü–Ø–¢–ê–ö ~50–∫ (–±—ã–ª–æ 1.88)allowConsolidated: true,icon: 'üöõ'},tenTon: {name: '10-—Ç–æ–Ω–Ω–∏–∫',maxWeight: 10000,maxVolume: 50,density: 200,minPrice: 24000,minPriceRegion: 18000,coefficient: 1.08,// –î–ï–°–Ø–¢–ö–ê ~63–∫ (–±—ã–ª–æ 1.84)allowConsolidated: true,icon: 'üöö'},truck: {name: '–§—É—Ä–∞ 20—Ç',maxWeight: 20000,maxVolume: 82, // –º¬≥ (–º–∏–Ω–∏–º—É–º –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ 82-92)density: 244, // –∫–≥/–º¬≥ (20000/82)minPrice: 28000,minPriceRegion: 21000,coefficient: 0.95,// –§–£–†–ê —ç–∫–æ–Ω–æ–º–∏—è –º–∞—Å—à—Ç–∞–±–∞ ~70–∫ (–±—ã–ª–æ 1.68)allowConsolidated: false, // –§–£–†–ê –ù–ï –°–ë–û–†–ù–´–ô!icon: 'üöö'}};// –†–ï–ê–õ–¨–ù–´–ï –ü–†–ò–ú–ï–†–´ –¶–ï–ù –æ—Ç –ò–ª—é—à–∏this.realPrices = {'–ì–æ–ª–∏—Ü—ã–Ω–æ-–ü–æ–≤–∞—Ä–æ–≤–æ': { distance: 40, price: 28000, pricePerKm: 700 },'–ì–æ–ª–∏—Ü—ã–Ω–æ-–í–æ—Å–∫—Ä–µ—Å–µ–Ω—Å–∫': { distance: 100, price: 28000, pricePerKm: 280 },'–ì–æ–ª–∏—Ü—ã–Ω–æ-–¢–≤–µ—Ä—å': { distance: 170, price: 35000, pricePerKm: 206 },'–ì–æ–ª–∏—Ü—ã–Ω–æ-–†—è–∑–∞–Ω—å': { distance: 180, price: 35000, pricePerKm: 194 },'–ì–æ–ª–∏—Ü—ã–Ω–æ-–ö–æ—Å—Ç—Ä–æ–º–∞': { distance: 340, price: 50000, pricePerKm: 147 },'–û–¥–∏–Ω—Ü–æ–≤–æ-–°–ü–±': { distance: 700, price: 70000, pricePerKm: 100 },'–°–ü–±-–û–¥–∏–Ω—Ü–æ–≤–æ': { distance: 700, price: 65000, pricePerKm: 93 }// –æ–±—Ä–∞—Ç–∫–∞ –¥–µ—à–µ–≤–ª–µ!};// –í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û: –í–ù–£–¢–†–ò –†–ï–ì–ò–û–ù–ê –°–ë–û–†–ù–´–• –ù–ï–¢!this.regions = {'–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': ['–ú–æ—Å–∫–≤–∞', '–ü–æ–¥–æ–ª—å—Å–∫', '–•–∏–º–∫–∏', '–ë–∞–ª–∞—à–∏—Ö–∞', '–ú—ã—Ç–∏—â–∏', '–ö–æ—Ä–æ–ª—ë–≤','–õ—é–±–µ—Ä—Ü—ã', '–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫', '–û–¥–∏–Ω—Ü–æ–≤–æ', '–ì–æ–ª–∏—Ü—ã–Ω–æ', '–ü–æ–≤–∞—Ä–æ–≤–æ','–í–æ—Å–∫—Ä–µ—Å–µ–Ω—Å–∫', '–ö–æ–ª–æ–º–Ω–∞', '–°–µ—Ä–ø—É—Ö–æ–≤', '–©—ë–ª–∫–æ–≤–æ', '–î–æ–º–æ–¥–µ–¥–æ–≤–æ'],'–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –∏ –æ–±–ª–∞—Å—Ç—å': ['–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ì–∞—Ç—á–∏–Ω–∞', '–í—ã–±–æ—Ä–≥', '–í—Å–µ–≤–æ–ª–æ–∂—Å–∫', '–ö–æ–ª–ø–∏–Ω–æ','–ü—É—à–∫–∏–Ω', '–ü–µ—Ç–µ—Ä–≥–æ—Ñ', '–ö—Ä–æ–Ω—à—Ç–∞–¥—Ç'],'–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': ['–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', '–î–∑–µ—Ä–∂–∏–Ω—Å–∫', '–ê—Ä–∑–∞–º–∞—Å', '–°–∞—Ä–æ–≤', '–ë–æ—Ä']};this.init();}// –ì–õ–ê–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –†–ê–°–ß–ï–¢–êasync calculatePrice(fromCity, toCity, weight, volume, cargoType = 'general') {// –í–ê–ñ–ù–û: –û—á–∏—â–∞–µ–º –∫–µ—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —Ä–∞—Å—á–µ—Ç–æ–º// –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç "–∑–∞–ª–∏–ø–∞–Ω–∏–µ" —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤try {// 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–Ω—É—Ç—Ä–∏—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–≤–æ–∑–∫—Éif (this.isSameRegion(fromCity, toCity)) {return {error: true,message: '–í–ù–ò–ú–ê–ù–ò–ï! –°–±–æ—Ä–Ω—ã–µ –≥—Ä—É–∑—ã —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏. –í–Ω—É—Ç—Ä–∏ —Ä–µ–≥–∏–æ–Ω–∞ - —Ç–æ–ª—å–∫–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞!',alternativePrice: await this.calculateFullTruckPrice(fromCity, toCity)};}// 2. –ü–æ–ª—É—á–∞–µ–º –†–ï–ê–õ–¨–ù–û–ï —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ APIconst distance = await this.distanceAPI.getDistance(fromCity, toCity);// 3. –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –†–ê–ó–î–ï–õ–ï–ù–ò–Øif (distance < 200) {// –õ–û–ö–ê–õ–¨–ù–´–ï –ò –ü–ï–†–ï–•–û–î–ù–ê–Ø –ó–û–ù–ê (–¥–æ 200–∫–º)return this.calculateLocalPrice(fromCity, toCity, weight, volume, distance, cargoType);} else {// –ú–ï–ñ–†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ï –ü–ï–†–ï–í–û–ó–ö–ò (200–∫–º+)return this.calculateInterregionalPrice(fromCity, toCity, weight, volume, distance, cargoType);}} catch (error) {throw error;}}// –õ–û–ö–ê–õ–¨–ù–´–ï –ü–ï–†–ï–í–û–ó–ö–ò - –ø–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç –≥–æ—Ä–æ–¥—Å–∫–∏—Ö –∫ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–ºcalculateLocalPrice(fromCity, toCity, weight, volume, distance, cargoType) {// –ü–æ–¥–±–∏—Ä–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Çconst optimalTransport = this.selectOptimalTransport(weight, volume);const transport = this.transportTypes[optimalTransport];// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–±–æ—Ä–Ω—ã–π –≥—Ä—É–∑ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞const isConsolidated = (cargoType === '—Å–±–æ—Ä–Ω—ã–π' || cargoType === 'consolidated') && transport.allowConsolidated;let basePrice;let priceCategory = '';if (distance <= 70) {// –ì–û–†–û–î–°–ö–ê–Ø –ë–ê–ó–ê - –º–∏–Ω–∏–º–∞–ª–∫–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞basePrice = transport.minPrice;priceCategory = '–ì–æ—Ä–æ–¥—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (–¥–æ 70–∫–º)';} else {// –ü–ï–†–ï–•–û–î–ù–ê–Ø –ó–û–ù–ê - –±–∞–∑–∞ + –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –¥–æ–ø–ª–∞—Ç–∞ –∑–∞ –∫–º –ø–æ —Ç–∏–ø—É –¢–°const excessKm = distance - 70; // –∫–º —Å–≤—ã—à–µ 70// –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –¢–ê–†–ò–§–´ –ü–û –¢–ò–ü–ê–ú –¢–° (—á–µ–º –±–æ–ª—å—à–µ –º–∞—à–∏–Ω–∞, —Ç–µ–º –¥–æ—Ä–æ–∂–µ –∫–º)const kmRates = {gazelle: 20, // 20‚ÇΩ/–∫–º –¥–ª—è –≥–∞–∑–µ–ª–∏threeTon: 25,// 25‚ÇΩ/–∫–º –¥–ª—è 3-—Ç–æ–Ω–Ω–∏–∫–∞fiveTon: 35, // 35‚ÇΩ/–∫–º –¥–ª—è 5-—Ç–æ–Ω–Ω–∏–∫–∞tenTon: 45,// 45‚ÇΩ/–∫–º –¥–ª—è 10-—Ç–æ–Ω–Ω–∏–∫–∞truck: 60// 60‚ÇΩ/–∫–º –¥–ª—è —Ñ—É—Ä—ã};const kmRate = kmRates[optimalTransport] || 25; // fallbackconst extraCost = excessKm * kmRate;basePrice = transport.minPrice + extraCost;priceCategory = `–ü–µ—Ä–µ—Ö–æ–¥–Ω–∞—è –∑–æ–Ω–∞ (${distance}–∫–º, +${excessKm}–∫–º √ó ${kmRate}‚ÇΩ)`;}// –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ (—á–µ–º –º–µ–Ω—å—à–µ –≥—Ä—É–∑, —Ç–µ–º –¥–æ—Ä–æ–∂–µ)const loadFactor = this.calculateLoadFactor(weight, volume, transport);// –î–õ–Ø –õ–û–ö–ê–õ–¨–ù–´–• - –ù–ï–¢ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —Ç–∏–ø–∞ –¢–° (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã)// –§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞const finalPrice = Math.round(basePrice * loadFactor);return {price: finalPrice,transport: transport.name,distance: distance,deliveryType: priceCategory,pricePerKm: Math.round(finalPrice / distance),deliveryTime: distance <= 100 ? '1 –¥–µ–Ω—å' : '1-2 –¥–Ω—è',details: {basePrice: transport.minPrice,distanceCoeff: loadFactor, // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏loadFactor: loadFactor,transportCoeff: 1.0, // –î–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫ –≤—Å–µ–≥–¥–∞ 1.0weight: weight,volume: volume,loadPercent: Math.round((weight / transport.maxWeight) * 100),volumePercent: volume ? Math.round((volume / transport.maxVolume) * 100) : 0,density: volume ? Math.round(weight / volume) : 0,isLocal: true,noConsolidated: true // –°–±–æ—Ä–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã}};}// –ú–ï–ñ–†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ï –ü–ï–†–ï–í–û–ó–ö–ò - –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞calculateInterregionalPrice(fromCity, toCity, weight, volume, distance, cargoType) {// –ù–û–í–ê–Ø –ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê: –ë–∞–∑–∞ = —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ √ó —Ç–∞—Ä–∏—Ñ, –ù–û –Ω–µ –º–µ–Ω–µ–µ –º–∏–Ω–∏–º–∞–ª–∫–∏ –¢–°let pricePerKm;let distanceCategory;if (distance < 200) {// –ë–õ–ò–ñ–ù–ò–ô –ü–û–î–ú–û–°–ö–û–í–ù–´–ô - —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π —Ç–∞—Ä–∏—ÑpricePerKm = 35;distanceCategory = '–ë–ª–∏–∂–Ω–∏–π (–¥–æ 200–∫–º)';} else if (distance < 300) {// –ë–õ–ò–ó–ö–ò–ô –†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ô - –≤—ã—Å–æ–∫–∏–π —Ç–∞—Ä–∏—Ñ (–Ø—Ä–æ—Å–ª–∞–≤–ª—å, –¢—É–ª–∞)pricePerKm = 28;distanceCategory = '–ë–ª–∏–∑–∫–∏–π (200-300–∫–º)';} else if (distance < 500) {// –°–†–ï–î–ù–ò–ô –†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ô - —Å—Ä–µ–¥–Ω–∏–π —Ç–∞—Ä–∏—Ñ (–í–æ—Ä–æ–Ω–µ–∂, –ù–∏–∂–Ω–∏–π)pricePerKm = 22;distanceCategory = '–°—Ä–µ–¥–Ω–∏–π (300-500–∫–º)';} else if (distance < 800) {// –î–ê–õ–¨–ù–ò–ô –ú–ï–ñ–†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ô - —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–π (–°–∞—Ä–∞–Ω—Å–∫, –ö–∞–∑–∞–Ω—å)pricePerKm = 18;distanceCategory = '–î–∞–ª—å–Ω–∏–π (500-800–∫–º)';} else if (distance < 1000) {// –î–ê–õ–¨–ù–û–ë–û–ô–ù–´–ô - —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–π (–°–ü–±, –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥)pricePerKm = 15;distanceCategory = '–î–∞–ª—å–Ω–æ–±–æ–π–Ω—ã–π (800-1000–∫–º)';} else {// –°–í–ï–†–•–î–ê–õ–¨–ù–ò–ô - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∞—Ä–∏—Ñ –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤pricePerKm = 18; // –ü–æ–≤—ã—à–∞–µ–º —Ç–∞—Ä–∏—Ñ –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤distanceCategory = '–°–≤–µ—Ä—Ö–¥–∞–ª—å–Ω–∏–π (1000–∫–º+)';}// –ü–æ–¥–±–∏—Ä–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Çconst optimalTransport = this.selectOptimalTransport(weight, volume);const transport = this.transportTypes[optimalTransport];// –ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê: –ë–∞–∑–∞ = —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ √ó —Ç–∞—Ä–∏—Ñlet basePrice = distance * pricePerKm;// –ñ–ï–°–¢–ö–ò–ï –ú–ò–ù–ò–ú–ê–õ–ö–ò –ü–û –¢–ò–ü–ê–ú –¢–° —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø–ª–µ—á (–¥–æ 200–∫–º)const transportMinPrices = {gazelle: distance < 200 ? 20000 : transport.minPriceRegion,threeTon: distance < 200 ? 25000 : transport.minPriceRegion,fiveTon: distance < 200 ? 30000 : transport.minPriceRegion,tenTon: distance < 200 ? 37000 : transport.minPriceRegion,truck: distance < 200 ? 42000 : transport.minPriceRegion};// –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–Ω–∏–º–∞–ª–∫—É –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞const minPrice = transportMinPrices[optimalTransport];basePrice = Math.max(basePrice, minPrice);// –î–û–ë–ê–í–õ–Ø–ï–ú ‚ÇΩ/–ö–ú –î–û–ü–õ–ê–¢–´ –ü–û –¢–ò–ü–£ –¢–° –ö –ú–ï–ñ–†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–úconst interregionalKmRates = {gazelle: 30, // 30‚ÇΩ/–∫–º –¥–ª—è –≥–∞–∑–µ–ª–∏threeTon: 40,// 40‚ÇΩ/–∫–º –¥–ª—è 3-—Ç–æ–Ω–Ω–∏–∫–∞fiveTon: 50, // 50‚ÇΩ/–∫–º –¥–ª—è 5-—Ç–æ–Ω–Ω–∏–∫–∞tenTon: 62,// 62‚ÇΩ/–∫–º –¥–ª—è 10-—Ç–æ–Ω–Ω–∏–∫–∞truck: 70// 70‚ÇΩ/–∫–º –¥–ª—è —Ñ—É—Ä—ã};const kmRate = interregionalKmRates[optimalTransport] || 15;const kmSurcharge = distance * kmRate;// –°–ë–û–†–ù–´–ï –ì–†–£–ó–´ (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ–∂—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∏ –ù–ï –¥–ª—è —Ñ—É—Ä!)const isConsolidated = (cargoType === '—Å–±–æ—Ä–Ω—ã–π' || cargoType === 'consolidated') && transport.allowConsolidated;// –î–ª—è —Å–±–æ—Ä–Ω—ã—Ö: –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–ª–∞—Ç—É –ø–æ —Ç–∏–ø—É –¢–° (kmSurcharge), —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π —Ç–∞—Ä–∏—Ñ –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –∏ –º–∏–Ω–∏–º–∞–ª–∫–∞if (!isConsolidated) {basePrice += kmSurcharge;}if (isConsolidated) {// –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–±–æ—Ä–Ω—ã–π –≥—Ä—É–∑ –¥–µ—à–µ–≤–ª–µ, –Ω–æ –Ω–µ –º–µ–Ω–µ–µ —Ä–∞–∑—É–º–Ω–æ–π –º–∏–Ω–∏–º–∞–ª–∫–∏const consolidatedPrice = basePrice * 0.65; // –°–∫–∏–¥–∫–∞ 35%const minConsolidatedPrice = transport.minPriceRegion * 0.8; // –ú–∏–Ω–∏–º—É–º 80% –æ—Ç –º–∏–Ω–∏–º–∞–ª–∫–∏ –¢–°basePrice = Math.max(consolidatedPrice, minConsolidatedPrice);}// –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –º–∞—Ä—à—Ä—É—Ç–∞const loadFactor = this.calculateLoadFactor(weight, volume, transport);const routeFactor = this.calculateRouteFactor(fromCity, toCity);const cargoFactor = this.getCargoFactor(cargoType);// –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢ –ó–û–ù–´ –î–û–°–¢–ê–í–ö–ò (–≤–º–µ—Å—Ç–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –¢–°)let zoneCoeff;if (distance < 70) {zoneCoeff = 1.6;// –ì–æ—Ä–æ–¥—Å–∫–∏–µ - —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –∫–æ—ç—Ñ—Ñ} else if (distance < 200) {zoneCoeff = 1.4;// –û–±–ª–∞—Å—Ç–Ω—ã–µ - –≤—ã—Å–æ–∫–∏–π –∫–æ—ç—Ñ—Ñ} else if (distance < 400) {zoneCoeff = 1.3;// –ú–µ–∂—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ - –ø–æ–≤—ã—à–µ–Ω–Ω—ã–π –∫–æ—ç—Ñ—Ñ} else if (distance < 800) {zoneCoeff = 1.1;// –°—Ä–µ–¥–Ω–µ–µ –ø–ª–µ—á–æ - –Ω–µ–±–æ–ª—å—à–∞—è –Ω–∞–¥–±–∞–≤–∫–∞} else if (distance < 1000) {zoneCoeff = 1.0;// –î–ª–∏–Ω–Ω–æ–µ –ø–ª–µ—á–æ - –±–∞–∑–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ} else {zoneCoeff = 1.05; // –°–≤–µ—Ä—Ö–¥–∞–ª—å–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã - –Ω–µ–±–æ–ª—å—à–∞—è –Ω–∞–¥–±–∞–≤–∫–∞}const transportCoeff = zoneCoeff; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç// –§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞const finalPrice = Math.round(basePrice * loadFactor * routeFactor * cargoFactor * transportCoeff);return {price: finalPrice,transport: transport.name,distance: distance,deliveryType: distanceCategory,pricePerKm: Math.round(finalPrice / distance),deliveryTime: this.calculateDeliveryTime(distance, isConsolidated),details: {basePrice: basePrice,minPrice: minPrice,pricePerKm: pricePerKm,distanceCoeff: loadFactor, // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–∫ distanceCoeffloadFactor: loadFactor,routeFactor: routeFactor,cargoFactor: cargoFactor,transportCoeff: transportCoeff,weight: weight,volume: volume,loadPercent: Math.round((weight / transport.maxWeight) * 100),volumePercent: volume ? Math.round((volume / transport.maxVolume) * 100) : 0,density: volume ? Math.round(weight / volume) : 0,isLocal: false,isConsolidated: isConsolidated}};}// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–¥–∏–Ω —Ä–µ–≥–∏–æ–ΩisSameRegion(city1, city2) {for (const [region, cities] of Object.entries(this.regions)) {const hasBoth = cities.includes(city1) && cities.includes(city2);if (hasBoth) return true;}return false;}// –ü–æ–¥–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –ø–æ –≤–µ—Å—É –∏ –æ–±—ä–µ–º—ÉselectOptimalTransport(weight, volume) {// –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –ø–æ –≥—Ä—É–∑–æ–ø–æ–¥—ä–µ–º–Ω–æ—Å—Ç–∏ (–æ—Ç –º–µ–Ω—å—à–µ–≥–æ –∫ –±–æ–ª—å—à–µ–º—É)const sortedTransports = Object.entries(this.transportTypes).sort((a, b) => a[1].maxWeight - b[1].maxWeight);for (const [key, transport] of sortedTransports) {if (weight <= transport.maxWeight) {if (volume && volume > 0) {// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–º, –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞if (volume <= transport.maxVolume) {return key; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª—é—á —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞}} else {// –ï—Å–ª–∏ –æ–±—ä–µ–º –Ω–µ —É–∫–∞–∑–∞–Ω, –≤—ã–±–∏—Ä–∞–µ–º –ø–æ –≤–µ—Å—Éreturn key;}}}// –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–¥–æ—à–ª–æ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ—É—Ä—Éreturn 'truck';}// –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏calculateLoadFactor(weight, volume, transport) {const weightUsage = weight / transport.maxWeight;// –ï—Å–ª–∏ –æ–±—ä–µ–º —É–∫–∞–∑–∞–Ω, —É—á–∏—Ç—ã–≤–∞–µ–º –µ–≥–æif (volume && volume > 0) {const volumeUsage = volume / transport.maxVolume;// –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê: –±–µ—Ä–µ–º —Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –ë–û–õ–¨–®–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–∞—à–∏–Ω—É// –≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä –ª–∏–º–∏—Ç–∏—Ä—É–µ—Ç (–≤–µ—Å –∏–ª–∏ –æ–±—ä–µ–º)const limitingUsage = Math.max(weightUsage, volumeUsage);// –ï—Å–ª–∏ –ø–µ—Ä–µ–≥—Ä—É–∑ –ø–æ –ª—é–±–æ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—É - –¥–æ–ø–ª–∞—Ç–∞if (limitingUsage > 1.0) {return 1.0 + (limitingUsage - 1.0) * 0.3; // –¥–æ–ø–ª–∞—Ç–∞ –∑–∞ –ø–µ—Ä–µ–≥—Ä—É–∑}// –ß–µ–º –í–´–®–ï –∑–∞–≥—Ä—É–∑–∫–∞, —Ç–µ–º –î–ï–®–ï–í–õ–ï (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ)if (limitingUsage > 0.8) return 1.0; // 80%+ - –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞if (limitingUsage > 0.6) return 1.1; // 60-80% - –Ω–µ–±–æ–ª—å—à–∞—è –¥–æ–ø–ª–∞—Ç–∞if (limitingUsage > 0.4) return 1.25;// 40-60% - —Å—Ä–µ–¥–Ω—è—è –¥–æ–ø–ª–∞—Ç–∞if (limitingUsage > 0.2) return 1.4; // 20-40% - –±–æ–ª—å—à–∞—è –¥–æ–ø–ª–∞—Ç–∞return 1.6;// –º–µ–Ω–µ–µ 20% - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–æ–ø–ª–∞—Ç–∞} else {// –ï—Å–ª–∏ –æ–±—ä–µ–º –Ω–µ —É–∫–∞–∑–∞–Ω, —Å—á–∏—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ –≤–µ—Å—Éif (weightUsage > 1.0) return 1.0 + (weightUsage - 1.0) * 0.3; // –ø–µ—Ä–µ–≥—Ä—É–∑if (weightUsage > 0.8) return 1.0; // 80%+ - –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞if (weightUsage > 0.6) return 1.1; // 60-80%if (weightUsage > 0.4) return 1.2; // 40-60%if (weightUsage > 0.2) return 1.35;// 20-40%return 1.5;// –º–µ–Ω–µ–µ 20% - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–æ–ø–ª–∞—Ç–∞}}// –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∞calculateRouteFactor(from, to) {// –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—èconst popularRoutes = [['–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥'],['–ú–æ—Å–∫–≤–∞', '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥'],['–ú–æ—Å–∫–≤–∞', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥'],['–ú–æ—Å–∫–≤–∞', '–ö–∞–∑–∞–Ω—å']];for (const route of popularRoutes) {if ((route.includes(from) && route.includes(to))) {return 0.9;// —Å–∫–∏–¥–∫–∞ –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã}}// –û–±—Ä–∞—Ç–∫–∞ –¥–µ—à–µ–≤–ª–µif (to === '–ú–æ—Å–∫–≤–∞' || to === '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥') {return 0.95;}return 1.0;}// –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ç–∏–ø–∞ –≥—Ä—É–∑–∞getCargoFactor(cargoType) {const factors = {'general': 1.0,// –æ–±—ã—á–Ω—ã–π'fragile': 1.3,// —Ö—Ä—É–ø–∫–∏–π'valuable': 1.5, // —Ü–µ–Ω–Ω—ã–π'dangerous': 1.8,// –æ–ø–∞—Å–Ω—ã–π'perishable': 1.4, // —Å–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–π—Å—è'oversized': 1.6 // –Ω–µ–≥–∞–±–∞—Ä–∏—Ç};return factors[cargoType] || 1.0;}// –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏calculateDeliveryTime(distance, isConsolidated = false) {let baseTime;if (distance < 500) baseTime = '1-2 –¥–Ω—è';else if (distance < 1000) baseTime = '2-3 –¥–Ω—è';else if (distance < 2000) baseTime = '3-4 –¥–Ω—è';else if (distance < 3000) baseTime = '4-5 –¥–Ω–µ–π';else baseTime = '5-7 –¥–Ω–µ–π';// –°–±–æ—Ä–Ω—ã–π –≥—Ä—É–∑ +30% –∫ –≤—Ä–µ–º–µ–Ω–∏if (isConsolidated) {const timeMap = {'1-2 –¥–Ω—è': '2-3 –¥–Ω—è','2-3 –¥–Ω—è': '3-4 –¥–Ω—è', '3-4 –¥–Ω—è': '4-5 –¥–Ω–µ–π','4-5 –¥–Ω–µ–π': '5-7 –¥–Ω–µ–π','5-7 –¥–Ω–µ–π': '7-9 –¥–Ω–µ–π'};return timeMap[baseTime] || baseTime;}return baseTime;}// –†–∞—Å—á–µ—Ç –ø–æ–ª–Ω–æ–π –º–∞—à–∏–Ω—ã –¥–ª—è –≤–Ω—É—Ç—Ä–∏—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Öasync calculateFullTruckPrice(from, to) {const distance = await this.distanceAPI.getDistance(from, to) || 50;const basePrice = 20000;// –º–∏–Ω–∏–º—É–º –¥–ª—è —Ñ—É—Ä—ãconst kmPrice = distance < 50 ? 500 : 200;return Math.max(basePrice, distance * kmPrice);}// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ API (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!)async getDistance(from, to) {try {// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –±–∞–∑—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–≤–µ—Ç–∞const staticRoutes = {// –û–°–ù–û–í–ù–´–ï –ú–ï–ñ–†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ï –ú–ê–†–®–†–£–¢–´'–ú–æ—Å–∫–≤–∞-–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥': 700,'–ú–æ—Å–∫–≤–∞-–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥': 400,'–ú–æ—Å–∫–≤–∞-–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': 1400,'–ú–æ—Å–∫–≤–∞-–ö–∞–∑–∞–Ω—å': 800,'–ú–æ—Å–∫–≤–∞-–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É': 1100,'–ú–æ—Å–∫–≤–∞-–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': 3300,'–ú–æ—Å–∫–≤–∞-–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä': 1200,'–ú–æ—Å–∫–≤–∞-–¢—é–º–µ–Ω—å': 2100,'–ú–æ—Å–∫–≤–∞-–í–æ—Ä–æ–Ω–µ–∂': 500,'–ú–æ—Å–∫–≤–∞-–°–∞–º–∞—Ä–∞': 1000,'–ú–æ—Å–∫–≤–∞-–£—Ñ–∞': 1200,'–ú–æ—Å–∫–≤–∞-–ß–µ–ª—è–±–∏–Ω—Å–∫': 1800,'–ú–æ—Å–∫–≤–∞-–ü–µ—Ä–º—å': 1400,'–ú–æ—Å–∫–≤–∞-–í–æ–ª–≥–æ–≥—Ä–∞–¥': 900,'–°–ü–±-–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': 1800,'–°–ü–±-–ö–∞–∑–∞–Ω—å': 1200,'–°–ü–±-–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥': 1000,// WB –°–ö–õ–ê–î–´ - –ú–û–°–ö–û–í–°–ö–ò–ô –†–ï–ì–ò–û–ù'–ú–æ—Å–∫–≤–∞-–ö–æ–ª–µ–¥–∏–Ω–æ': 25,'–ú–æ—Å–∫–≤–∞-–ü–æ–¥–æ–ª—å—Å–∫': 40,'–ú–æ—Å–∫–≤–∞-–ë–µ–ª—ã–µ –°—Ç–æ–ª–±—ã': 50,'–ú–æ—Å–∫–≤–∞-–†–∞–¥—É–º–ª—è': 60,'–ú–æ—Å–∫–≤–∞-–ü—É—à–∫–∏–Ω–æ': 35,'–ú–æ—Å–∫–≤–∞-–í—ë—à–∫–∏': 30,'–ú–æ—Å–∫–≤–∞-–ß–µ—Ö–æ–≤': 55,'–ú–æ—Å–∫–≤–∞-–û–±—É—Ö–æ–≤–æ': 45,'–ú–æ—Å–∫–≤–∞-–°—ã–Ω–∫–æ–≤–æ': 50,// –†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ï –ú–ê–†–®–†–£–¢–´'–ú–æ—Å–∫–≤–∞-–¢–≤–µ—Ä—å': 170,'–ú–æ—Å–∫–≤–∞-–¢—É–ª–∞': 190,'–ú–æ—Å–∫–≤–∞-–†—è–∑–∞–Ω—å': 250,'–ú–æ—Å–∫–≤–∞-–ö–∞–ª—É–≥–∞': 160,'–ú–æ—Å–∫–≤–∞-–°–º–æ–ª–µ–Ω—Å–∫': 400,'–ú–æ—Å–∫–≤–∞-–Ø—Ä–æ—Å–ª–∞–≤–ª—å': 260,'–ú–æ—Å–∫–≤–∞-–í–ª–∞–¥–∏–º–∏—Ä': 190};const routeKey = `${from}-${to}`;const reverseKey = `${to}-${from}`;// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –±–∞–∑—Éconst staticDistance = staticRoutes[routeKey] || staticRoutes[reverseKey];if (staticDistance) {return staticDistance;}// –ï—Å–ª–∏ –Ω–µ—Ç –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –±–∞–∑–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º API// –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API –∞–≤—Ç–æ–¥–∏—Å–ø–µ—Ç—á–µ—Ä.—Ä—Éconst response = await fetch(`https://www.avtodispetcher.ru/distance/api/?from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}&format=json`, {method: 'GET',headers: {'Accept': 'application/json'}});if (response.ok) {const data = await response.json();if (data && data.distance && data.distance > 0) {return Math.round(data.distance);}}// Fallback - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µreturn this.calculateApproximateDistance(from, to);} catch (error) {return this.calculateApproximateDistance(from, to);}}// –ü—Ä–∏–º–µ—Ä–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º (fallback)calculateApproximateDistance(from, to) {// –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –ø–æ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–≥–∞–ºconst regionDistances = {'–ú–æ—Å–∫–≤–∞': { '–°–ü–±': 700, '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': 1400, '–ö–∞–∑–∞–Ω—å': 800, '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä': 1200 },'–°–ü–±': { '–ú–æ—Å–∫–≤–∞': 700, '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': 1800, '–ö–∞–∑–∞–Ω—å': 1200 },'–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': { '–ú–æ—Å–∫–≤–∞': 1400, '–°–ü–±': 1800, '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': 1800 },'–ö–∞–∑–∞–Ω—å': { '–ú–æ—Å–∫–≤–∞': 800, '–°–ü–±': 1200, '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': 1000 },'–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä': { '–ú–æ—Å–∫–≤–∞': 1200, '–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É': 300 },'–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫': { '–ú–æ—Å–∫–≤–∞': 3300, '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥': 1800 }};// –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–æ–≤const normalizeCity = (city) => {if (city.includes('–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥') || city.includes('–°–ü–±')) return '–°–ü–±';if (city.includes('–ú–æ—Å–∫–≤')) return '–ú–æ—Å–∫–≤–∞';if (city.includes('–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥')) return '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥';if (city.includes('–ö–∞–∑–∞–Ω')) return '–ö–∞–∑–∞–Ω—å';if (city.includes('–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä')) return '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä';if (city.includes('–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫')) return '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫';return city;};const fromNorm = normalizeCity(from);const toNorm = normalizeCity(to);if (regionDistances[fromNorm] && regionDistances[fromNorm][toNorm]) {return regionDistances[fromNorm][toNorm];}// –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ä–µ–¥–Ω–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µreturn 500;}// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø UIinit() {// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤const form = document.getElementById('calculatorForm');if (!form) {return;}// –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è –¥–µ–º–æthis.setupAutocomplete();}// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞—Å—á–µ—Ç–∞handleCalculation() {// –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µconst fromCity = document.getElementById('fromCity')?.value || '';const toCity = document.getElementById('toCity')?.value || '';const weight = parseFloat(document.getElementById('weight')?.value || 0);const volume = parseFloat(document.getElementById('volume')?.value || 0);const isConsolidated = document.getElementById('isConsolidated')?.checked || false;// –í–∞–ª–∏–¥–∞—Ü–∏—èif (!fromCity || !toCity || !weight) {alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≥–æ—Ä–æ–¥–∞ –∏ –≤–µ—Å –≥—Ä—É–∑–∞!');return;}// –û–±—ä–µ–º –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π, –Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ωif (volume && volume <= 0) {alert('–û–±—ä–µ–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0!');return;}// –†–∞—Å—á–µ—Çconst cargoType = isConsolidated ? 'consolidated' : 'general';this.calculatePrice(fromCity, toCity, weight, volume, cargoType).then(result => {this.showResult(result);}).catch(error => {alert('–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞: ' + error.message);});}// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞showResult(result) {const resultDiv = document.getElementById('calculatorResult') || this.createResultDiv();if (result.error) {resultDiv.innerHTML = `<div class="alert alert-warning"><h4>‚ö†Ô∏è ${result.message}</h4>${result.alternativePrice ? `<p>–°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã: <strong>${result.alternativePrice.toLocaleString()} ‚ÇΩ</strong></p>` : ''}<p>–ü–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è: <a href="tel:+79162720932">+7 (916) 272-09-32</a></p></div>`;} else {resultDiv.innerHTML = `<div class="calc-success"><h3>üéØ –†–∞—Å—á–µ—Ç –≥–æ—Ç–æ–≤!</h3><div class="price-block"><div class="price-main"><span class="price-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏:</span><span class="price-value">${result.price.toLocaleString()} ‚ÇΩ</span></div><div class="price-info"><p>üöõ ${result.transport}</p><p>üìÖ ${result.deliveryTime}</p></div></div><div class="cta-buttons"><button class="btn btn-primary btn-lg" onclick="smartCalculatorV2.showLeadForm()">üìù –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button><button class="btn btn-secondary" onclick="smartCalculatorV2.callManager()">üìû +7 (916) 272-09-32</button></div><div class="disclaimer"><p><small>* –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</small></p></div></div>`;}// –°–∫—Ä–æ–ª–ª–∏–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ÉresultDiv.style.display = 'block';resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });}// –°–æ–∑–¥–∞–Ω–∏–µ div –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞createResultDiv() {const div = document.createElement('div');div.id = 'calculatorResult';div.className = 'calculator-result';const form = document.getElementById('calculatorForm');if (form) {form.parentNode.insertBefore(div, form.nextSibling);} else {// Fallback - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞const calcSection = document.querySelector('.calculator-section, #calculator');if (calcSection) {calcSection.appendChild(div);}}return div;}// –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Å–±–æ—Ä–∞ –ª–∏–¥–æ–≤showLeadForm() {const leadForm = document.getElementById('leadForm');if (leadForm) {leadForm.style.display = 'block';leadForm.scrollIntoView({ behavior: 'smooth', block: 'center' });// –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞this.fillLeadFormData();// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏this.setupLeadFormHandler();}}// –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞fillLeadFormData() {const fromCity = document.getElementById('fromCity')?.value || '';const toCity = document.getElementById('toCity')?.value || '';const weight = document.getElementById('weight')?.value || '';const volume = document.getElementById('volume')?.value || '';const transport = document.getElementById('transport')?.value || '';const comment = document.getElementById('leadComment');if (comment) {comment.value = `–ú–∞—Ä—à—Ä—É—Ç: ${fromCity} ‚Üí ${toCity}\n–í–µ—Å: ${weight} –∫–≥\n–û–±—ä–µ–º: ${volume} –º¬≥\n–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${transport}`;}}// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ñ–æ—Ä–º—ã –ª–∏–¥–æ–≤setupLeadFormHandler() {const form = document.getElementById('calculatorLeadForm');if (form) {form.addEventListener('submit', (e) => {e.preventDefault();this.handleLeadFormSubmit(e);});}}// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –ª–∏–¥–æ–≤handleLeadFormSubmit(e) {const formData = new FormData(e.target);const data = {name: formData.get('name'),phone: formData.get('phone'),email: formData.get('email'),comment: formData.get('comment'),timestamp: new Date().toISOString(),source: 'calculator'};// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—Éconst submitBtn = e.target.querySelector('button[type="submit"]');const btnText = submitBtn.querySelector('.btn-text');const btnLoading = submitBtn.querySelector('.btn-loading');btnText.style.display = 'none';btnLoading.style.display = 'inline';// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ (–º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å form-handler.js)this.sendLeadData(data).then(() => {this.showLeadSuccess();}).catch((error) => {this.showLeadError(error);}).finally(() => {btnText.style.display = 'inline';btnLoading.style.display = 'none';});}// –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ª–∏–¥–∞async sendLeadData(data) {// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ telegram-sender.jsif (window.sendToTelegram) {return window.sendToTelegram(data, 'calculator');}// –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å father_bot.py —á–µ—Ä–µ–∑ Telegramconst promoCode = document.getElementById('promoCode')?.textContent || 'GOST10';const message = `üéØ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞:\n\nüë§ –ò–º—è: ${data.name}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${data.phone}\nüìß Email: ${data.email}\nüí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${data.comment}\nüéÅ –ü—Ä–æ–º–æ–∫–æ–¥: ${promoCode}\n‚è∞ –ò—Å—Ç–æ—á–Ω–∏–∫: —Ñ–æ—Ä–º–∞ –ª–∏–¥–æ–≤`;// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ father_bot –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–ºwindow.open(`https://t.me/father_bot?start=${encodeURIComponent(message)}`, '_blank');// –õ–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö)return Promise.resolve();}// –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—ÉshowLeadSuccess() {const leadForm = document.getElementById('leadForm');if (leadForm) {leadForm.innerHTML = `<div class="lead-success"><div class="success-icon">‚úÖ</div><h3>–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h3><p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.</p><button class="btn btn-primary" onclick="location.reload()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –µ—â–µ —Ä–∞–∑</button></div>`;}}// –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏showLeadError(error) {const leadForm = document.getElementById('leadForm');if (leadForm) {leadForm.innerHTML = `<div class="lead-error"><div class="error-icon">‚ùå</div><h3>–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</h3><p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞–º –Ω–∞–ø—Ä—è–º—É—é: <a href="tel:+79162720932">+7 (916) 272-09-32</a></p><button class="btn btn-primary" onclick="location.reload()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button></div>`;}}// –ö–Ω–æ–ø–∫–∞ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)orderNow() {this.showLeadForm();}// –ö–Ω–æ–ø–∫–∞ –ø–æ–∑–≤–æ–Ω–∏—Ç—åcallManager() {window.location.href = 'tel:+79162720932';}// –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤setupAutocomplete() {// –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –±–∞–∑—É –≥–æ—Ä–æ–¥–æ–≤ –∏–∑ cities-simple.jsif (typeof POPULAR_CITIES !== 'undefined') {// –î–æ–±–∞–≤–ª—è–µ–º datalist —Å –ø–æ–ª–Ω–æ–π –±–∞–∑–æ–πconst datalist = document.createElement('datalist');datalist.id = 'cities-list';POPULAR_CITIES.forEach(city => {const option = document.createElement('option');option.value = city;datalist.appendChild(option);});document.body.appendChild(datalist);// –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ –∏–Ω–ø—É—Ç–∞–ºdocument.getElementById('fromCity')?.setAttribute('list', 'cities-list');document.getElementById('toCity')?.setAttribute('list', 'cities-list');} else {// Fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –±–∞–∑—É –µ—Å–ª–∏ cities-simple.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ωconst cities = ['–ú–æ—Å–∫–≤–∞', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥','–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', '–ö–∞–∑–∞–Ω—å', '–ß–µ–ª—è–±–∏–Ω—Å–∫', '–°–∞–º–∞—Ä–∞', '–û–º—Å–∫','–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É', '–£—Ñ–∞', '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫', '–í–æ—Ä–æ–Ω–µ–∂', '–ü–µ—Ä–º—å'];const datalist = document.createElement('datalist');datalist.id = 'cities-list';cities.forEach(city => {const option = document.createElement('option');option.value = city;datalist.appendChild(option);});document.body.appendChild(datalist);document.getElementById('fromCity')?.setAttribute('list', 'cities-list');document.getElementById('toCity')?.setAttribute('list', 'cities-list');}}}// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µdocument.addEventListener('DOMContentLoaded', () => {window.smartCalculatorV2 = new SmartCalculatorV2();// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Exit-Intent Pop-upinitExitIntentPopup();// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Sticky HeaderinitStickyHeader();// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞ –∏ —Ç–∞–π–º–µ—Ä–∞initPromoTimer();// –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞updatePromoTimer();// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ü–îinitPrivacyConsent();});// Exit-Intent Pop-up –ª–æ–≥–∏–∫–∞function initExitIntentPopup() {let hasShownPopup = false;let mouseLeaveCount = 0;// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –ª–∏ —É–∂–µ pop-up –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏if (sessionStorage.getItem('exitPopupShown')) {return;}// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏document.addEventListener('mouseleave', (e) => {if (e.clientY <= 0 && !hasShownPopup && mouseLeaveCount === 0) {mouseLeaveCount++;setTimeout(() => {showExitPopup();}, 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞}});// –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –Ω–∞–∂–∞—Ç–∏–µ Escapedocument.addEventListener('keydown', (e) => {if (e.key === 'Escape' && !hasShownPopup) {showExitPopup();}});}// –ü–æ–∫–∞–∑–∞—Ç—å Exit-Intent Pop-upfunction showExitPopup() {const popup = document.getElementById('exitIntentPopup');if (popup) {popup.classList.add('show');sessionStorage.setItem('exitPopupShown', 'true');// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ñ–æ—Ä–º—ãsetupExitFormHandler();}}// –ó–∞–∫—Ä—ã—Ç—å Exit-Intent Pop-upfunction closeExitPopup() {const popup = document.getElementById('exitIntentPopup');if (popup) {popup.classList.remove('show');}}// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ñ–æ—Ä–º—ã Exit-Intentfunction setupExitFormHandler() {const form = document.getElementById('exitLeadForm');if (form) {form.addEventListener('submit', (e) => {e.preventDefault();handleExitFormSubmit(e);});}}// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã Exit-Intentfunction handleExitFormSubmit(e) {const formData = new FormData(e.target);const data = {name: formData.get('name'),phone: formData.get('phone'),email: formData.get('email'),promoCode: 'WELCOME10',source: 'exit-intent-popup',timestamp: new Date().toISOString()};// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—Éconst submitBtn = e.target.querySelector('button[type="submit"]');const originalText = submitBtn.textContent;submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';submitBtn.disabled = true;// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µsendExitLeadData(data).then(() => {showExitSuccess();}).catch((error) => {showExitError(error);}).finally(() => {submitBtn.textContent = originalText;submitBtn.disabled = false;});}// –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö Exit-Intent –ª–∏–¥–∞async function sendExitLeadData(data) {// –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–º–æ–∫–æ–¥ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –∫ –¥–∞–Ω–Ω—ã–ºdata.promoCode = 'WELCOME10';data.source = 'Exit-Intent Pop-up';// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ telegram-sender.jsif (window.sendToTelegram) {return window.sendToTelegram(data, 'exitIntent');}// –ï—Å–ª–∏ telegram-sender.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–ø—Ä—è–º—É—étry {const botToken = '79162720932:AAGOAjQLmEZuT4SFx4Upl1GjuXO0yFuWok8';const chatId = '399711407';const message = `üéÅ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —Å exit-intent:\n\nüë§ –ò–º—è: ${data.name}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${data.phone}\nüìß Email: ${data.email}\nüéÅ –ü—Ä–æ–º–æ–∫–æ–¥: ${data.promoCode}\n‚è∞ –ò—Å—Ç–æ—á–Ω–∏–∫: ${data.source}`;const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {method: 'POST',headers: { 'Content-Type': 'application/json' },body: JSON.stringify({ chat_id: chatId, text: message })});if (response.ok) {return Promise.resolve();}} catch (error) {}return Promise.resolve();}// –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É Exit-Intentfunction showExitSuccess() {const popup = document.getElementById('exitIntentPopup');if (popup) {popup.innerHTML = `<div class="exit-popup-content"><div class="exit-popup-header"><h3>‚úÖ –£—Å–ø–µ—à–Ω–æ!</h3><button class="exit-popup-close" onclick="closeExitPopup()">√ó</button></div><div class="exit-popup-body"><div class="exit-popup-icon">üéâ</div><h4>–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞—è–≤–∫—É!</h4><p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º —Å–∫–∏–¥–∫—É 10% –Ω–∞ –ø–µ—Ä–≤—É—é –ø–µ—Ä–µ–≤–æ–∑–∫—É.</p><div class="exit-popup-footer"><small>–ü—Ä–æ–º–æ–∫–æ–¥: <strong>WELCOME10</strong></small></div></div></div>`;}}// –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ Exit-Intentfunction showExitError(error) {const popup = document.getElementById('exitIntentPopup');if (popup) {popup.innerHTML = `<div class="exit-popup-content"><div class="exit-popup-header"><h3>‚ùå –û—à–∏–±–∫–∞</h3><button class="exit-popup-close" onclick="closeExitPopup()">√ó</button></div><div class="exit-popup-body"><div class="exit-popup-icon">üòî</div><h4>–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫</h4><p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞–º –Ω–∞–ø—Ä—è–º—É—é: <a href="tel:+79162720932">+7 (916) 272-09-32</a></p><p>–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ WhatsApp: <a href="https://wa.me/79162720932">–ù–∞–ø–∏—Å–∞—Ç—å</a></p></div></div>`;}}// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Öif (typeof module !== 'undefined' && module.exports) {module.exports = SmartCalculatorV2;}// Sticky Header –ª–æ–≥–∏–∫–∞function initStickyHeader() {let lastScrollTop = 0;const stickyHeader = document.getElementById('stickyHeader');const header = document.getElementById('header');if (stickyHeader && header) {window.addEventListener('scroll', () => {const scrollTop = window.pageYOffset || document.documentElement.scrollTop;const headerHeight = header.offsetHeight;// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º sticky header –ø–æ—Å–ª–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∑–∞ –æ—Å–Ω–æ–≤–Ω–æ–π headerif (scrollTop > headerHeight && scrollTop > lastScrollTop) {stickyHeader.classList.add('visible');} else if (scrollTop <= headerHeight || scrollTop < lastScrollTop) {stickyHeader.classList.remove('visible');}});}}// –ü—Ä–æ–º–æ–∫–æ–¥ –∏ —Ç–∞–π–º–µ—Ä –ª–æ–≥–∏–∫–∞function initPromoTimer() {let timeLeft = 15 * 60; // 15 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Öconst timerMinutes = document.getElementById('timerMinutes');const timerSeconds = document.getElementById('timerSeconds');const promoSection = document.querySelector('.promo-section');if (!timerMinutes || !timerSeconds) {return;}const timer = setInterval(() => {const minutes = Math.floor(timeLeft / 60);const seconds = timeLeft % 60;timerMinutes.textContent = minutes.toString().padStart(2, '0');timerSeconds.textContent = seconds.toString().padStart(2, '0');timeLeft--;if (timeLeft < 0) {clearInterval(timer);hidePromoTimer();}}, 1000);}// –°–∫—Ä—ã—Ç—å —Ç–∞–π–º–µ—Ä –ø—Ä–æ–º–æ–∫–æ–¥–∞function hidePromoTimer() {const promoSection = document.querySelector('.promo-section');if (promoSection) {promoSection.style.display = 'none';}}// –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –ø—Ä–æ–º–æ–∫–æ–¥–∞function updatePromoTimer() {const timerMinutes = document.getElementById('timerMinutes');const timerSeconds = document.getElementById('timerSeconds');if (timerMinutes && timerSeconds) {// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤ localStorageconst savedTime = localStorage.getItem('promoTimerEnd');if (savedTime) {const endTime = parseInt(savedTime);const now = Date.now();const timeLeft = Math.max(0, Math.floor((endTime - now) / 1000));if (timeLeft > 0) {const minutes = Math.floor(timeLeft / 60);const seconds = timeLeft % 60;timerMinutes.textContent = minutes.toString().padStart(2, '0');timerSeconds.textContent = seconds.toString().padStart(2, '0');// –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—ÄsetTimeout(updatePromoTimer, 1000);} else {hidePromoTimer();}}}}// –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Öfunction initPrivacyConsent() {const consentCheckbox = document.getElementById('privacyConsent');const submitBtn = document.getElementById('leadSubmitBtn') || document.getElementById('contactSubmitBtn');if (consentCheckbox && submitBtn) {// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µsubmitBtn.disabled = !consentCheckbox.checked;// –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ–∫–±–æ–∫—Å–∞consentCheckbox.addEventListener('change', function() {submitBtn.disabled = !this.checked;if (this.checked) {submitBtn.classList.remove('btn-disabled');submitBtn.classList.add('btn-primary');} else {submitBtn.classList.add('btn-disabled');submitBtn.classList.remove('btn-primary');}});}}