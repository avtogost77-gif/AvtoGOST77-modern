#!/bin/bash

echo "üö® EMERGENCY DEPLOY - SONNET VERSION"
echo "====================================="
echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –º–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, —Ñ–æ—Ä–º—ã, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ critical —Ñ–∞–π–ª–æ–≤
echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π..."

EMERGENCY_FILES=(
    "assets/css/emergency-mobile-fix.css"
    "assets/js/emergency-fix.js"
    "index.html"
)

for file in "${EMERGENCY_FILES[@]}"; do
    if [ -f "$file" ]; then
        echo "‚úÖ $file - OK"
    else
        echo "‚ùå $file - –û–¢–°–£–¢–°–¢–í–£–ï–¢!"
        exit 1
    fi
done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
echo ""
echo "üìä –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:"
ls -lh assets/css/emergency-mobile-fix.css
ls -lh assets/js/emergency-fix.js

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
BACKUP_DATE=$(date +%Y%m%d_%H%M%S)
echo ""
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏..."

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
echo ""
echo "üåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É..."
if ping -c 1 31.31.197.43 &> /dev/null; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω"
else
    echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!"
    exit 1
fi

# –ó–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
echo ""
echo "üöÄ –ì–û–¢–û–í –ö –≠–ö–°–¢–†–ï–ù–ù–û–ú–£ –î–ï–ü–õ–û–Æ!"
echo ""
echo "üéØ –ß—Ç–æ –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:"
echo "   ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (48px+, touch-action)"
echo "   ‚úÖ iOS —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (zoom fix, tap delay)"
echo "   ‚úÖ –§–æ—Ä–º–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (submit handler)"
echo "   ‚úÖ –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (smooth scroll)"
echo "   ‚úÖ –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (vibration)"
echo "   ‚úÖ Visual feedback (click indicators)"
echo ""
echo "üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:"
echo "   üì± 100% —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö"
echo "   üéØ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏"
echo "   ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –∫–Ω–æ–ø–æ–∫"
echo ""

read -p "üî• –ù–∞—á–∞—Ç—å —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π? (y/n): " -n 1 -r
echo ""

if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "‚ùå –î–µ–ø–ª–æ–π –æ—Ç–º–µ–Ω–µ–Ω"
    exit 1
fi

echo ""
echo "üîÑ –ó–ê–ü–£–°–ö –≠–ö–°–¢–†–ï–ù–ù–û–ì–û –î–ï–ü–õ–û–Ø..."

# SSH –¥–∞–Ω–Ω—ã–µ
SSH_HOST="31.31.197.43"
SSH_USER="u3207373"
SSH_PASS="5x8cZ19H0rWhh6Qt"
REMOTE_DIR="www/avtogost77.ru"

# –ó–∞–≥—Ä—É–∑–∫–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
echo "üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π..."

# –°–æ–∑–¥–∞–µ–º batch –¥–ª—è SFTP
cat > emergency_sftp.txt << EOF
cd $REMOTE_DIR
put assets/css/emergency-mobile-fix.css assets/css/
put assets/js/emergency-fix.js assets/js/
put index.html
bye
EOF

# –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É
if command -v sshpass &> /dev/null; then
    sshpass -p "$SSH_PASS" sftp -oBatchMode=no -b emergency_sftp.txt $SSH_USER@$SSH_HOST
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤!"
        exit 1
    fi
else
    echo "‚ö†Ô∏è  sshpass –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π sftp"
    echo "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å: $SSH_PASS"
    sftp -b emergency_sftp.txt $SSH_USER@$SSH_HOST
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
sshpass -p "$SSH_PASS" ssh $SSH_USER@$SSH_HOST "cd $REMOTE_DIR && ls -la assets/css/emergency-mobile-fix.css assets/js/emergency-fix.js"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
echo "üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞..."
sshpass -p "$SSH_PASS" ssh $SSH_USER@$SSH_HOST "cd $REMOTE_DIR && chmod 644 *.html assets/css/*.css assets/js/*.js"

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
rm -f emergency_sftp.txt

echo ""
echo "üéâ –≠–ö–°–¢–†–ï–ù–ù–´–ô –î–ï–ü–õ–û–ô –ó–ê–í–ï–†–®–ï–ù!"
echo ""
echo "üéØ –†–ï–ó–£–õ–¨–¢–ê–¢:"
echo "   ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã"
echo "   ‚úÖ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç"
echo "   ‚úÖ –§–æ—Ä–º—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã"
echo "   ‚úÖ iOS —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å"
echo ""
echo "üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:"
echo "   1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://avtogost77.ru"
echo "   2. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º"
echo "   3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DevTools ‚Üí Console (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏)"
echo "   4. –ù–∞–∂–º–∏—Ç–µ –≤—Å–µ –∫–Ω–æ–ø–∫–∏"
echo "   5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"
echo ""
echo "üîß –û–¢–õ–ê–î–ö–ê:"
echo "   - –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞"
echo "   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–ª–∏–∫–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ"
echo "   - –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å"
echo ""
echo "üìû –ö–û–ù–¢–ê–ö–¢–´:"
echo "   –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:"
echo "   WhatsApp: +7 916 272-09-32"
echo ""
echo "üöÄ –°–ê–ô–¢ –°–ü–ê–°–ï–ù! –ö–û–ù–í–ï–†–°–ò–Ø –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ê! üí™"