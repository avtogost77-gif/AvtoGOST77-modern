#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–∞—Ç–æ–≤ –º–µ–∂–¥—É Cursor Desktop –∏ Web
# ===================================================================

echo "üîß Cursor Chat Sync Fix Tool"
echo "==========================="
echo ""

# –¶–≤–µ—Ç–∞
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

# –ù–∞—Ö–æ–¥–∏–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Cursor
CURSOR_DIRS=(
    "$HOME/.config/Cursor"
    "$HOME/.cursor"
    "$HOME/.local/share/Cursor"
)

echo -e "${YELLOW}‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à Cursor${NC}"
echo -e "${YELLOW}   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –≤–∞–∂–Ω—ã–µ –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!${NC}"
echo ""
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/N): " -n 1 -r
echo ""

if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "–û—Ç–º–µ–Ω–µ–Ω–æ."
    exit 0
fi

echo ""
echo "üßπ –®–∞–≥ 1: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö..."

for dir in "${CURSOR_DIRS[@]}"; do
    if [ -d "$dir" ]; then
        echo -e "${YELLOW}–û–±—Ä–∞–±–æ—Ç–∫–∞: $dir${NC}"
        
        # –û—á–∏—â–∞–µ–º –∫—ç—à
        if [ -d "$dir/Cache" ]; then
            rm -rf "$dir/Cache"/*
            echo "   ‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω"
        fi
        
        # –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        if [ -f "$dir/User/globalStorage/state.vscdb" ]; then
            # –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
            cp "$dir/User/globalStorage/state.vscdb" "$dir/User/globalStorage/state.vscdb.backup"
            echo "   ‚úÖ –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø —Å–æ—Å—Ç–æ—è–Ω–∏—è"
        fi
        
        # –û—á–∏—â–∞–µ–º –ª–æ–≥–∏
        if [ -d "$dir/logs" ]; then
            rm -rf "$dir/logs"/*
            echo "   ‚úÖ –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã"
        fi
    fi
done

echo ""
echo "üîÑ –®–∞–≥ 2: –°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏..."

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
SETTINGS_FILE="$HOME/.cursor/User/settings.json"
if [ -f "$SETTINGS_FILE" ]; then
    # –ë—ç–∫–∞–ø –Ω–∞—Å—Ç—Ä–æ–µ–∫
    cp "$SETTINGS_FILE" "$SETTINGS_FILE.backup"
    echo "   ‚úÖ –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø –Ω–∞—Å—Ç—Ä–æ–µ–∫"
fi

echo ""
echo -e "${GREEN}‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}"
echo ""
echo "üìã –¢–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo ""
echo "1. ${GREEN}–ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä–æ–π—Ç–µ Cursor Desktop${NC}"
echo "   - File ‚Üí Exit (–Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ)"
echo ""
echo "2. ${GREEN}–û—Ç–∫—Ä–æ–π—Ç–µ Cursor Desktop –∑–∞–Ω–æ–≤–æ${NC}"
echo ""
echo "3. ${GREEN}–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é${NC}"
echo "   - Settings ‚Üí Account"
echo "   - –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç"
echo ""
echo "4. ${GREEN}–ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã${NC}"
echo "   - –î–∞–π—Ç–µ –≤—Ä–µ–º—è –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é"
echo ""
echo "5. ${GREEN}–û—Ç–∫—Ä–æ–π—Ç–µ Cursor Web${NC}"
echo "   - –í–æ–π–¥–∏—Ç–µ –≤ —Ç–æ—Ç –∂–µ –∞–∫–∫–∞—É–Ω—Ç"
echo "   - –ß–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è"
echo ""
echo "üÜò –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ:"
echo "   ‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ VPN (–∏–Ω–æ–≥–¥–∞ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å–µ—Ä–≤–µ—Ä–∞–º)"
echo "   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª/–∞–Ω—Ç–∏–≤–∏—Ä—É—Å"
echo "   ‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É: hi@cursor.com"
echo ""
echo "üí° –°–æ–≤–µ—Ç: –í–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤ Settings ‚Üí Sync"