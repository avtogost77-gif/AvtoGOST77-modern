#!/bin/bash

# üöÄ –°–ö–†–ò–ü–¢ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –° VPS
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å VPS, —É–¥–∞–ª—è—è –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å VPS..."
echo "=================================="

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
VPS_HOST="root@5378159-xv69554"  # –¢–≤–æ–π VPS
VPS_PATH="/var/www/avtogost77"
REPO_URL="https://github.com/avtogost77-gif/AvtoGOST77-modern.git"

# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ VPS
COMMANDS='
cd '"$VPS_PATH"' || exit 1

echo "üìç –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"
echo "üìä –°—Ç–∞—Ç—É—Å –¥–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:"
git status --short

echo -e "\nüîÑ –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
git fetch origin main

echo -e "\nüßπ –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
git reset --hard origin/main

echo -e "\nüóëÔ∏è –£–¥–∞–ª—è–µ–º –Ω–µ–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã..."
# –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
echo "–ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã:"
git clean -fdn
# –ó–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º
git clean -fd

echo -e "\n‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üìä –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å:"
git status --short
git log --oneline -1

echo -e "\nüìÅ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ HTML —Ñ–∞–π–ª–æ–≤:"
find . -name "*.html" -type f | wc -l
'

# –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã –Ω–∞ VPS
echo "üîê –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ VPS..."
ssh $VPS_HOST "$COMMANDS"

if [ $? -eq 0 ]; then
    echo -e "\n‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
else
    echo -e "\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏!"
    exit 1
fi

echo -e "\nüí° –°–æ–≤–µ—Ç: –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤ GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏!"