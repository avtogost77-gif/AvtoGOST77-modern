class SmartCalculatorV2{constructor(){this.distanceAPI=new DistanceAPI,this.transportTypes={gazelle:{name:"–ì–∞–∑–µ–ª—å",maxWeight:1500,maxVolume:16,density:94,minPrice:1e4,minPriceRegion:7500,coefficient:1,allowConsolidated:!0,icon:"üöê"},threeTon:{name:"3-—Ç–æ–Ω–Ω–∏–∫",maxWeight:3e3,maxVolume:18,density:167,minPrice:13e3,minPriceRegion:9750,coefficient:1,allowConsolidated:!0,icon:"üöõ"},fiveTon:{name:"5-—Ç–æ–Ω–Ω–∏–∫",maxWeight:5e3,maxVolume:36,density:139,minPrice:2e4,minPriceRegion:15e3,coefficient:1.05,allowConsolidated:!0,icon:"üöõ"},tenTon:{name:"10-—Ç–æ–Ω–Ω–∏–∫",maxWeight:1e4,maxVolume:50,density:200,minPrice:24e3,minPriceRegion:18e3,coefficient:1.08,allowConsolidated:!0,icon:"üöö"},truck:{name:"–§—É—Ä–∞ 20—Ç",maxWeight:2e4,maxVolume:82,density:244,minPrice:28e3,minPriceRegion:21e3,coefficient:.95,allowConsolidated:!1,icon:"üöö"}},this.realPrices={"–ì–æ–ª–∏—Ü—ã–Ω–æ-–ü–æ–≤–∞—Ä–æ–≤–æ":{distance:40,price:28e3,pricePerKm:700},"–ì–æ–ª–∏—Ü—ã–Ω–æ-–í–æ—Å–∫—Ä–µ—Å–µ–Ω—Å–∫":{distance:100,price:28e3,pricePerKm:280},"–ì–æ–ª–∏—Ü—ã–Ω–æ-–¢–≤–µ—Ä—å":{distance:170,price:35e3,pricePerKm:206},"–ì–æ–ª–∏—Ü—ã–Ω–æ-–†—è–∑–∞–Ω—å":{distance:180,price:35e3,pricePerKm:194},"–ì–æ–ª–∏—Ü—ã–Ω–æ-–ö–æ—Å—Ç—Ä–æ–º–∞":{distance:340,price:5e4,pricePerKm:147},"–û–¥–∏–Ω—Ü–æ–≤–æ-–°–ü–±":{distance:700,price:7e4,pricePerKm:100},"–°–ü–±-–û–¥–∏–Ω—Ü–æ–≤–æ":{distance:700,price:65e3,pricePerKm:93}},this.regions={"–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å":["–ú–æ—Å–∫–≤–∞","–ü–æ–¥–æ–ª—å—Å–∫","–•–∏–º–∫–∏","–ë–∞–ª–∞—à–∏—Ö–∞","–ú—ã—Ç–∏—â–∏","–ö–æ—Ä–æ–ª—ë–≤","–õ—é–±–µ—Ä—Ü—ã","–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫","–û–¥–∏–Ω—Ü–æ–≤–æ","–ì–æ–ª–∏—Ü—ã–Ω–æ","–ü–æ–≤–∞—Ä–æ–≤–æ","–í–æ—Å–∫—Ä–µ—Å–µ–Ω—Å–∫","–ö–æ–ª–æ–º–Ω–∞","–°–µ—Ä–ø—É—Ö–æ–≤","–©—ë–ª–∫–æ–≤–æ","–î–æ–º–æ–¥–µ–¥–æ–≤–æ"],"–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –∏ –æ–±–ª–∞—Å—Ç—å":["–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥","–ì–∞—Ç—á–∏–Ω–∞","–í—ã–±–æ—Ä–≥","–í—Å–µ–≤–æ–ª–æ–∂—Å–∫","–ö–æ–ª–ø–∏–Ω–æ","–ü—É—à–∫–∏–Ω","–ü–µ—Ç–µ—Ä–≥–æ—Ñ","–ö—Ä–æ–Ω—à—Ç–∞–¥—Ç"],"–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å":["–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥","–î–∑–µ—Ä–∂–∏–Ω—Å–∫","–ê—Ä–∑–∞–º–∞—Å","–°–∞—Ä–æ–≤","–ë–æ—Ä"]},this.init()}async calculatePrice(e,t,n,o,i="general"){console.log(`üîç –ù–ê–ß–ò–ù–ê–ï–ú –†–ê–°–ß–ï–¢: ${e} ‚Üí ${t}, –≤–µ—Å: ${n}–∫–≥, –æ–±—ä–µ–º: ${o}–º¬≥, —Ç–∏–ø: ${i}`),console.log("üßπ –û–ß–ò–©–ê–ï–ú –ö–ï–® –ø–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–æ–º");try{if(this.isSameRegion(e,t))return console.log(`‚ö†Ô∏è –í–ù–£–¢–†–ò–†–ï–ì–ò–û–ù–ê–õ–¨–ù–ê–Ø –ü–ï–†–ï–í–û–ó–ö–ê: ${e} ‚Üí ${t}`),{error:!0,message:"–í–ù–ò–ú–ê–ù–ò–ï! –°–±–æ—Ä–Ω—ã–µ –≥—Ä—É–∑—ã —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏. –í–Ω—É—Ç—Ä–∏ —Ä–µ–≥–∏–æ–Ω–∞ - —Ç–æ–ª—å–∫–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞!",alternativePrice:await this.calculateFullTruckPrice(e,t)};console.log(`üó∫Ô∏è –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú –†–ê–°–°–¢–û–Ø–ù–ò–ï: ${e} ‚Üí ${t}`);const a=await this.distanceAPI.getDistance(e,t);return console.log(`üìè –ü–û–õ–£–ß–ò–õ–ò –†–ê–°–°–¢–û–Ø–ù–ò–ï: ${a}–∫–º –¥–ª—è ${e} ‚Üí ${t}`),a<200?(console.log(`üè† –õ–û–ö–ê–õ–¨–ù–ê–Ø –ó–û–ù–ê: ${a}–∫–º < 200–∫–º`),this.calculateLocalPrice(e,t,n,o,a,i)):(console.log(`üöõ –ú–ï–ñ–†–ï–ì–ò–û–ù–ê–õ–¨–ù–ê–Ø: ${a}–∫–º >= 200–∫–º`),this.calculateInterregionalPrice(e,t,n,o,a,i))}catch(e){throw console.error("‚ùå Error in calculatePrice:",e),e}}calculateLocalPrice(e,t,n,o,i,a){const c=this.selectOptimalTransport(n,o),r=this.transportTypes[c];("—Å–±–æ—Ä–Ω—ã–π"===a||"consolidated"===a)&&r.allowConsolidated;let s,l="";if(i<=70)s=r.minPrice,l="–ì–æ—Ä–æ–¥—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (–¥–æ 70–∫–º)";else{const e=i-70,t={gazelle:20,threeTon:25,fiveTon:35,tenTon:45,truck:60}[c]||25,n=e*t;s=r.minPrice+n,l=`–ü–µ—Ä–µ—Ö–æ–¥–Ω–∞—è –∑–æ–Ω–∞ (${i}–∫–º, +${e}–∫–º √ó ${t}‚ÇΩ)`}const d=this.calculateLoadFactor(n,o,r),m=Math.round(s*d);return{price:m,transport:r.name,distance:i,deliveryType:l,pricePerKm:Math.round(m/i),deliveryTime:i<=100?"1 –¥–µ–Ω—å":"1-2 –¥–Ω—è",details:{basePrice:r.minPrice,distanceCoeff:d,loadFactor:d,transportCoeff:1,weight:n,volume:o,loadPercent:Math.round(n/r.maxWeight*100),volumePercent:o?Math.round(o/r.maxVolume*100):0,density:o?Math.round(n/o):0,isLocal:!0,noConsolidated:!0}}}calculateInterregionalPrice(e,t,n,o,i,a){let c,r;i<200?(c=35,r="–ë–ª–∏–∂–Ω–∏–π (–¥–æ 200–∫–º)"):i<300?(c=28,r="–ë–ª–∏–∑–∫–∏–π (200-300–∫–º)"):i<500?(c=22,r="–°—Ä–µ–¥–Ω–∏–π (300-500–∫–º)"):i<800?(c=18,r="–î–∞–ª—å–Ω–∏–π (500-800–∫–º)"):(c=15,r="–î–∞–ª—å–Ω–æ–±–æ–π–Ω—ã–π (800–∫–º+)");const s=this.selectOptimalTransport(n,o),l=this.transportTypes[s];let d=i*c;const m={gazelle:i<200?2e4:l.minPriceRegion,threeTon:i<200?25e3:l.minPriceRegion,fiveTon:i<200?3e4:l.minPriceRegion,tenTon:i<200?37e3:l.minPriceRegion,truck:i<200?42e3:l.minPriceRegion}[s];d=Math.max(d,m);d+=i*({gazelle:30,threeTon:40,fiveTon:50,tenTon:62,truck:70}[s]||15);const u=("—Å–±–æ—Ä–Ω—ã–π"===a||"consolidated"===a)&&l.allowConsolidated;u&&(d*=.65);const p=this.calculateLoadFactor(n,o,l),h=this.calculateRouteFactor(e,t),g=this.getCargoFactor(a);let y;y=i<70?1.6:i<200?1.4:i<400?1.3:i<800?1.1:1;const v=y,f=Math.round(d*p*h*g*v);return{price:f,transport:l.name,distance:i,deliveryType:r,pricePerKm:Math.round(f/i),deliveryTime:this.calculateDeliveryTime(i,u),details:{basePrice:d,minPrice:m,pricePerKm:c,distanceCoeff:p,loadFactor:p,routeFactor:h,cargoFactor:g,transportCoeff:v,weight:n,volume:o,loadPercent:Math.round(n/l.maxWeight*100),volumePercent:o?Math.round(o/l.maxVolume*100):0,density:o?Math.round(n/o):0,isLocal:!1,isConsolidated:u}}}isSameRegion(e,t){for(const[n,o]of Object.entries(this.regions)){if(o.includes(e)&&o.includes(t))return!0}return!1}selectOptimalTransport(e,t){const n=Object.entries(this.transportTypes).sort((e,t)=>e[1].maxWeight-t[1].maxWeight);for(const[o,i]of n)if(e<=i.maxWeight){if(!(t&&t>0))return o;if(t<=i.maxVolume)return o}return"truck"}calculateLoadFactor(e,t,n){const o=e/n.maxWeight;if(t&&t>0){const e=t/n.maxVolume,i=Math.max(o,e);return i>1?1+.3*(i-1):i>.8?1:i>.6?1.1:i>.4?1.25:i>.2?1.4:1.6}return o>1?1+.3*(o-1):o>.8?1:o>.6?1.1:o>.4?1.2:o>.2?1.35:1.5}calculateRouteFactor(e,t){const n=[["–ú–æ—Å–∫–≤–∞","–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥"],["–ú–æ—Å–∫–≤–∞","–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥"],["–ú–æ—Å–∫–≤–∞","–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥"],["–ú–æ—Å–∫–≤–∞","–ö–∞–∑–∞–Ω—å"]];for(const o of n)if(o.includes(e)&&o.includes(t))return.9;return"–ú–æ—Å–∫–≤–∞"===t||"–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥"===t?.95:1}getCargoFactor(e){return{general:1,fragile:1.3,valuable:1.5,dangerous:1.8,perishable:1.4,oversized:1.6}[e]||1}calculateDeliveryTime(e,t=!1){let n;if(n=e<500?"1-2 –¥–Ω—è":e<1e3?"2-3 –¥–Ω—è":e<2e3?"3-4 –¥–Ω—è":e<3e3?"4-5 –¥–Ω–µ–π":"5-7 –¥–Ω–µ–π",t){return{"1-2 –¥–Ω—è":"2-3 –¥–Ω—è","2-3 –¥–Ω—è":"3-4 –¥–Ω—è","3-4 –¥–Ω—è":"4-5 –¥–Ω–µ–π","4-5 –¥–Ω–µ–π":"5-7 –¥–Ω–µ–π","5-7 –¥–Ω–µ–π":"7-9 –¥–Ω–µ–π"}[n]||n}return n}async calculateFullTruckPrice(e,t){const n=await this.distanceAPI.getDistance(e,t)||50,o=n<50?500:200;return Math.max(2e4,n*o)}async getDistance(e,t){try{const n={"–ú–æ—Å–∫–≤–∞-–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥":700,"–ú–æ—Å–∫–≤–∞-–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥":400,"–ú–æ—Å–∫–≤–∞-–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥":1400,"–ú–æ—Å–∫–≤–∞-–ö–∞–∑–∞–Ω—å":800,"–ú–æ—Å–∫–≤–∞-–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É":1100,"–ú–æ—Å–∫–≤–∞-–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫":3300,"–ú–æ—Å–∫–≤–∞-–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä":1200,"–ú–æ—Å–∫–≤–∞-–¢—é–º–µ–Ω—å":2100,"–ú–æ—Å–∫–≤–∞-–í–æ—Ä–æ–Ω–µ–∂":500,"–ú–æ—Å–∫–≤–∞-–°–∞–º–∞—Ä–∞":1e3,"–ú–æ—Å–∫–≤–∞-–£—Ñ–∞":1200,"–ú–æ—Å–∫–≤–∞-–ß–µ–ª—è–±–∏–Ω—Å–∫":1800,"–ú–æ—Å–∫–≤–∞-–ü–µ—Ä–º—å":1400,"–ú–æ—Å–∫–≤–∞-–í–æ–ª–≥–æ–≥—Ä–∞–¥":900,"–°–ü–±-–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥":1800,"–°–ü–±-–ö–∞–∑–∞–Ω—å":1200,"–°–ü–±-–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥":1e3,"–ú–æ—Å–∫–≤–∞-–ö–æ–ª–µ–¥–∏–Ω–æ":25,"–ú–æ—Å–∫–≤–∞-–ü–æ–¥–æ–ª—å—Å–∫":40,"–ú–æ—Å–∫–≤–∞-–ë–µ–ª—ã–µ –°—Ç–æ–ª–±—ã":50,"–ú–æ—Å–∫–≤–∞-–†–∞–¥—É–º–ª—è":60,"–ú–æ—Å–∫–≤–∞-–ü—É—à–∫–∏–Ω–æ":35,"–ú–æ—Å–∫–≤–∞-–í—ë—à–∫–∏":30,"–ú–æ—Å–∫–≤–∞-–ß–µ—Ö–æ–≤":55,"–ú–æ—Å–∫–≤–∞-–û–±—É—Ö–æ–≤–æ":45,"–ú–æ—Å–∫–≤–∞-–°—ã–Ω–∫–æ–≤–æ":50,"–ú–æ—Å–∫–≤–∞-–¢–≤–µ—Ä—å":170,"–ú–æ—Å–∫–≤–∞-–¢—É–ª–∞":190,"–ú–æ—Å–∫–≤–∞-–†—è–∑–∞–Ω—å":250,"–ú–æ—Å–∫–≤–∞-–ö–∞–ª—É–≥–∞":160,"–ú–æ—Å–∫–≤–∞-–°–º–æ–ª–µ–Ω—Å–∫":400,"–ú–æ—Å–∫–≤–∞-–Ø—Ä–æ—Å–ª–∞–≤–ª—å":260,"–ú–æ—Å–∫–≤–∞-–í–ª–∞–¥–∏–º–∏—Ä":190},o=`${e}-${t}`,i=`${t}-${e}`,a=n[o]||n[i];if(a)return a;console.log(`üîç –ó–∞–ø—Ä–∞—à–∏–≤–∞—é —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ API: ${e} ‚Üí ${t}`);const c=await fetch(`https://www.avtodispetcher.ru/distance/api/?from=${encodeURIComponent(e)}&to=${encodeURIComponent(t)}&format=json`,{method:"GET",headers:{Accept:"application/json"}});if(c.ok){const e=await c.json();if(e&&e.distance&&e.distance>0)return console.log(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ API: ${e.distance} –∫–º`),Math.round(e.distance)}return console.log(`‚ö†Ô∏è API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è ${e}-${t}`),this.calculateApproximateDistance(e,t)}catch(n){return console.log(`‚ùå –û—à–∏–±–∫–∞ API —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π: ${n.message}`),this.calculateApproximateDistance(e,t)}}calculateApproximateDistance(e,t){const n={"–ú–æ—Å–∫–≤–∞":{"–°–ü–±":700,"–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥":1400,"–ö–∞–∑–∞–Ω—å":800,"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä":1200},"–°–ü–±":{"–ú–æ—Å–∫–≤–∞":700,"–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥":1800,"–ö–∞–∑–∞–Ω—å":1200},"–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥":{"–ú–æ—Å–∫–≤–∞":1400,"–°–ü–±":1800,"–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫":1800},"–ö–∞–∑–∞–Ω—å":{"–ú–æ—Å–∫–≤–∞":800,"–°–ü–±":1200,"–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥":1e3},"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä":{"–ú–æ—Å–∫–≤–∞":1200,"–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É":300},"–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫":{"–ú–æ—Å–∫–≤–∞":3300,"–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥":1800}},o=e=>e.includes("–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥")||e.includes("–°–ü–±")?"–°–ü–±":e.includes("–ú–æ—Å–∫–≤")?"–ú–æ—Å–∫–≤–∞":e.includes("–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥")?"–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥":e.includes("–ö–∞–∑–∞–Ω")?"–ö–∞–∑–∞–Ω—å":e.includes("–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä")?"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä":e.includes("–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫")?"–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫":e,i=o(e),a=o(t);return n[i]&&n[i][a]?n[i][a]:500}init(){document.getElementById("calculatorForm")&&this.setupAutocomplete()}handleCalculation(){const e=document.getElementById("fromCity")?.value||"",t=document.getElementById("toCity")?.value||"",n=parseFloat(document.getElementById("weight")?.value||0),o=parseFloat(document.getElementById("volume")?.value||0),i=document.getElementById("isConsolidated")?.checked||!1;if(!e||!t||!n)return void alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≥–æ—Ä–æ–¥–∞ –∏ –≤–µ—Å –≥—Ä—É–∑–∞!");if(o&&o<=0)return void alert("–û–±—ä–µ–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0!");const a=i?"consolidated":"general";this.calculatePrice(e,t,n,o,a).then(n=>{console.log(`üí∞ ${e} ‚Üí ${t}: ${n.price.toLocaleString()} ‚ÇΩ`),this.showResult(n)}).catch(e=>{console.error("‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞:",e),alert("–û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞: "+e.message)})}showResult(e){const t=document.getElementById("calculatorResult")||this.createResultDiv();e.error?t.innerHTML=`\n        <div class="alert alert-warning">\n          <h4>‚ö†Ô∏è ${e.message}</h4>\n          ${e.alternativePrice?`<p>–°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã: <strong>${e.alternativePrice.toLocaleString()} ‚ÇΩ</strong></p>`:""}\n          <p>–ü–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è: <a href="tel:+79162720932">+7 (916) 272-09-32</a></p>\n        </div>\n      `:t.innerHTML=`\n        <div class="calc-success">\n          <h3>üéØ –†–∞—Å—á–µ—Ç –≥–æ—Ç–æ–≤!</h3>\n          \n          <div class="price-block">\n            <div class="price-main">\n              <span class="price-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏:</span>\n              <span class="price-value">${e.price.toLocaleString()} ‚ÇΩ</span>\n            </div>\n            <div class="price-info">\n              <p>üöõ ${e.transport}</p>\n              <p>üìÖ ${e.deliveryTime}</p>\n            </div>\n          </div>\n\n          <div class="cta-buttons">\n            <button class="btn btn-primary btn-lg" onclick="smartCalculatorV2.showLeadForm()">\n              üìù –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É\n            </button>\n            <button class="btn btn-secondary" onclick="smartCalculatorV2.callManager()">\n              üìû +7 (916) 272-09-32\n            </button>\n          </div>\n\n          <div class="disclaimer">\n            <p><small>* –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</small></p>\n          </div>\n        </div>\n      `,t.style.display="block",t.scrollIntoView({behavior:"smooth",block:"center"})}createResultDiv(){const e=document.createElement("div");e.id="calculatorResult",e.className="calculator-result";const t=document.getElementById("calculatorForm");if(t)t.parentNode.insertBefore(e,t.nextSibling);else{const t=document.querySelector(".calculator-section, #calculator");t&&t.appendChild(e)}return e}showLeadForm(){const e=document.getElementById("leadForm");e&&(e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"center"}),this.fillLeadFormData(),this.setupLeadFormHandler())}fillLeadFormData(){const e=document.getElementById("fromCity")?.value||"",t=document.getElementById("toCity")?.value||"",n=document.getElementById("weight")?.value||"",o=document.getElementById("volume")?.value||"",i=document.getElementById("transport")?.value||"",a=document.getElementById("leadComment");a&&(a.value=`–ú–∞—Ä—à—Ä—É—Ç: ${e} ‚Üí ${t}\n–í–µ—Å: ${n} –∫–≥\n–û–±—ä–µ–º: ${o} –º¬≥\n–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${i}`)}setupLeadFormHandler(){const e=document.getElementById("calculatorLeadForm");e&&e.addEventListener("submit",e=>{e.preventDefault(),this.handleLeadFormSubmit(e)})}handleLeadFormSubmit(e){const t=new FormData(e.target),n={name:t.get("name"),phone:t.get("phone"),email:t.get("email"),comment:t.get("comment"),timestamp:(new Date).toISOString(),source:"calculator"},o=e.target.querySelector('button[type="submit"]'),i=o.querySelector(".btn-text"),a=o.querySelector(".btn-loading");i.style.display="none",a.style.display="inline",this.sendLeadData(n).then(()=>{this.showLeadSuccess()}).catch(e=>{this.showLeadError(e)}).finally(()=>{i.style.display="inline",a.style.display="none"})}async sendLeadData(e){if(window.sendToTelegram)return window.sendToTelegram(e,"calculator");const t=document.getElementById("promoCode")?.textContent||"GOST10",n=`üéØ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞:\n\nüë§ –ò–º—è: ${e.name}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${e.phone}\nüìß Email: ${e.email}\nüí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${e.comment}\nüéÅ –ü—Ä–æ–º–æ–∫–æ–¥: ${t}\n‚è∞ –ò—Å—Ç–æ—á–Ω–∏–∫: —Ñ–æ—Ä–º–∞ –ª–∏–¥–æ–≤`;return window.open(`https://t.me/father_bot?start=${encodeURIComponent(n)}`,"_blank"),Promise.resolve()}showLeadSuccess(){const e=document.getElementById("leadForm");e&&(e.innerHTML='\n        <div class="lead-success">\n          <div class="success-icon">‚úÖ</div>\n          <h3>–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h3>\n          <p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.</p>\n          <button class="btn btn-primary" onclick="location.reload()">\n            –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –µ—â–µ —Ä–∞–∑\n          </button>\n        </div>\n      ')}showLeadError(e){const t=document.getElementById("leadForm");t&&(t.innerHTML='\n        <div class="lead-error">\n          <div class="error-icon">‚ùå</div>\n          <h3>–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</h3>\n          <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞–º –Ω–∞–ø—Ä—è–º—É—é: <a href="tel:+79162720932">+7 (916) 272-09-32</a></p>\n          <button class="btn btn-primary" onclick="location.reload()">\n            –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞\n          </button>\n        </div>\n      ')}orderNow(){this.showLeadForm()}callManager(){window.location.href="tel:+79162720932"}setupAutocomplete(){if("undefined"!=typeof POPULAR_CITIES){const e=document.createElement("datalist");e.id="cities-list",POPULAR_CITIES.forEach(t=>{const n=document.createElement("option");n.value=t,e.appendChild(n)}),document.body.appendChild(e),document.getElementById("fromCity")?.setAttribute("list","cities-list"),document.getElementById("toCity")?.setAttribute("list","cities-list")}else{const e=["–ú–æ—Å–∫–≤–∞","–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥","–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥","–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥","–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫","–ö–∞–∑–∞–Ω—å","–ß–µ–ª—è–±–∏–Ω—Å–∫","–°–∞–º–∞—Ä–∞","–û–º—Å–∫","–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É","–£—Ñ–∞","–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫","–í–æ—Ä–æ–Ω–µ–∂","–ü–µ—Ä–º—å"],t=document.createElement("datalist");t.id="cities-list",e.forEach(e=>{const n=document.createElement("option");n.value=e,t.appendChild(n)}),document.body.appendChild(t),document.getElementById("fromCity")?.setAttribute("list","cities-list"),document.getElementById("toCity")?.setAttribute("list","cities-list")}}}function initExitIntentPopup(){let e=0;sessionStorage.getItem("exitPopupShown")||(document.addEventListener("mouseleave",t=>{t.clientY<=0&&0===e&&(e++,setTimeout(()=>{showExitPopup()},1e3))}),document.addEventListener("keydown",e=>{"Escape"===e.key&&showExitPopup()}))}function showExitPopup(){const e=document.getElementById("exitIntentPopup");e&&(e.classList.add("show"),sessionStorage.setItem("exitPopupShown","true"),setupExitFormHandler())}function closeExitPopup(){const e=document.getElementById("exitIntentPopup");e&&e.classList.remove("show")}function setupExitFormHandler(){const e=document.getElementById("exitLeadForm");e&&e.addEventListener("submit",e=>{e.preventDefault(),handleExitFormSubmit(e)})}function handleExitFormSubmit(e){const t=new FormData(e.target),n={name:t.get("name"),phone:t.get("phone"),email:t.get("email"),promoCode:"WELCOME10",source:"exit-intent-popup",timestamp:(new Date).toISOString()},o=e.target.querySelector('button[type="submit"]'),i=o.textContent;o.textContent="–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...",o.disabled=!0,sendExitLeadData(n).then(()=>{showExitSuccess()}).catch(e=>{showExitError(e)}).finally(()=>{o.textContent=i,o.disabled=!1})}async function sendExitLeadData(e){if(e.promoCode="WELCOME10",e.source="Exit-Intent Pop-up",window.sendToTelegram)return window.sendToTelegram(e,"exitIntent");try{const t="7999458907:AAGOAjQLmEZuT4SFx4Upl1GjuXO0yFuWok8",n="399711407",o=`üéÅ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ —Å exit-intent:\n\nüë§ –ò–º—è: ${e.name}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${e.phone}\nüìß Email: ${e.email}\nüéÅ –ü—Ä–æ–º–æ–∫–æ–¥: ${e.promoCode}\n‚è∞ –ò—Å—Ç–æ—á–Ω–∏–∫: ${e.source}`;if((await fetch(`https://api.telegram.org/bot${t}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:n,text:o})})).ok)return Promise.resolve()}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ exit-intent –∑–∞—è–≤–∫–∏")}return Promise.resolve()}function showExitSuccess(){const e=document.getElementById("exitIntentPopup");e&&(e.innerHTML='\n      <div class="exit-popup-content">\n        <div class="exit-popup-header">\n          <h3>‚úÖ –£—Å–ø–µ—à–Ω–æ!</h3>\n          <button class="exit-popup-close" onclick="closeExitPopup()">√ó</button>\n        </div>\n        <div class="exit-popup-body">\n          <div class="exit-popup-icon">üéâ</div>\n          <h4>–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞—è–≤–∫—É!</h4>\n          <p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º —Å–∫–∏–¥–∫—É 10% –Ω–∞ –ø–µ—Ä–≤—É—é –ø–µ—Ä–µ–≤–æ–∑–∫—É.</p>\n          <div class="exit-popup-footer">\n            <small>–ü—Ä–æ–º–æ–∫–æ–¥: <strong>WELCOME10</strong></small>\n          </div>\n        </div>\n      </div>\n    ')}function showExitError(e){const t=document.getElementById("exitIntentPopup");t&&(t.innerHTML='\n      <div class="exit-popup-content">\n        <div class="exit-popup-header">\n          <h3>‚ùå –û—à–∏–±–∫–∞</h3>\n          <button class="exit-popup-close" onclick="closeExitPopup()">√ó</button>\n        </div>\n        <div class="exit-popup-body">\n          <div class="exit-popup-icon">üòî</div>\n          <h4>–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫</h4>\n          <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞–º –Ω–∞–ø—Ä—è–º—É—é: <a href="tel:+79162720932">+7 (916) 272-09-32</a></p>\n          <p>–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ WhatsApp: <a href="https://wa.me/79162720932">–ù–∞–ø–∏—Å–∞—Ç—å</a></p>\n        </div>\n      </div>\n    ')}function initStickyHeader(){const e=document.getElementById("stickyHeader"),t=document.getElementById("header");e&&t&&window.addEventListener("scroll",()=>{const n=window.pageYOffset||document.documentElement.scrollTop,o=t.offsetHeight;n>o&&n>0?e.classList.add("visible"):(n<=o||n<0)&&e.classList.remove("visible")})}function initPromoTimer(){let e=900;const t=document.getElementById("timerMinutes"),n=document.getElementById("timerSeconds");document.querySelector(".promo-section");if(!t||!n)return;const o=setInterval(()=>{const i=Math.floor(e/60),a=e%60;t.textContent=i.toString().padStart(2,"0"),n.textContent=a.toString().padStart(2,"0"),e--,e<0&&(clearInterval(o),hidePromoTimer())},1e3)}function hidePromoTimer(){const e=document.querySelector(".promo-section");e&&(e.style.display="none")}function updatePromoTimer(){const e=document.getElementById("timerMinutes"),t=document.getElementById("timerSeconds");if(e&&t){const n=localStorage.getItem("promoTimerEnd");if(n){const o=parseInt(n),i=Date.now(),a=Math.max(0,Math.floor((o-i)/1e3));if(a>0){const n=Math.floor(a/60),o=a%60;e.textContent=n.toString().padStart(2,"0"),t.textContent=o.toString().padStart(2,"0"),setTimeout(updatePromoTimer,1e3)}else hidePromoTimer()}}}function initPrivacyConsent(){const e=document.getElementById("privacyConsent"),t=document.getElementById("leadSubmitBtn")||document.getElementById("contactSubmitBtn");e&&t&&(t.disabled=!e.checked,e.addEventListener("change",function(){t.disabled=!this.checked,this.checked?(t.classList.remove("btn-disabled"),t.classList.add("btn-primary")):(t.classList.add("btn-disabled"),t.classList.remove("btn-primary"))}))}document.addEventListener("DOMContentLoaded",()=>{window.smartCalculatorV2=new SmartCalculatorV2,initExitIntentPopup(),initStickyHeader(),initPromoTimer(),updatePromoTimer(),initPrivacyConsent()}),"undefined"!=typeof module&&module.exports&&(module.exports=SmartCalculatorV2);