name: SEO Pages Auto-Generator

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞
    - cron: '0 */6 * * *'
  workflow_dispatch:
    inputs:
      pages_count:
        description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'
        required: false
        default: '50'
      strategy:
        description: '–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'
        required: false
        default: 'routes'
        type: choice
        options:
        - routes
        - routes-extended
        - industries
        - calculators

jobs:
  generate-seo-pages:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: Cache dependencies
      uses: actions/cache@v3
      with:
        path: ~/.npm
        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-node-

    - name: Install dependencies (simplified)
      run: |
        echo "–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ Node.js –º–æ–¥—É–ª–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏"

    - name: Generate Routes Pages (Simple)
      if: ${{ github.event.inputs.strategy == 'routes' }}
      run: node .github/scripts/generate-routes-simple.js
      env:
        PAGES_COUNT: ${{ github.event.inputs.pages_count || '15' }}

    - name: Generate Routes Pages (Extended with Marketplaces)
      if: ${{ github.event.inputs.strategy == 'routes-extended' || github.event.schedule }}
      run: node .github/scripts/generate-routes-extended.js
      env:
        PAGES_COUNT: ${{ github.event.inputs.pages_count || '50' }}

    - name: Generate Industry Pages
      if: ${{ github.event.inputs.strategy == 'industries' }}
      run: node .github/scripts/generate-industries.js
      env:
        PAGES_COUNT: ${{ github.event.inputs.pages_count || '6' }}

    - name: Generate Calculator Pages
      if: ${{ github.event.inputs.strategy == 'calculators' }}
      run: node .github/scripts/generate-calculators.js
      env:
        PAGES_COUNT: ${{ github.event.inputs.pages_count || '6' }}

    - name: Update Sitemap
      run: node .github/scripts/update-sitemap.js

    - name: Update Internal Links
      run: node .github/scripts/update-links.js

    - name: Commit and Push
      run: |
        git config --local user.email "seo-bot@avtogost77.ru"
        git config --local user.name "SEO Auto-Generator"
        git add .
        git diff --staged --quiet || git commit -m "ü§ñ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è SEO —Å—Ç—Ä–∞–Ω–∏—Ü - $(date '+%Y-%m-%d %H:%M') | –°—Ç—Ä–∞—Ç–µ–≥–∏—è: ${{ github.event.inputs.strategy || 'routes-extended' }} | –°—Ç—Ä–∞–Ω–∏—Ü: ${{ github.event.inputs.pages_count || '50' }}"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Deploy to Server (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      if: success()
      run: |
        echo "üéâ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ì–ï–ù–ï–†–ê–¶–ò–ò:"
        echo "üìç –ú–∞—Ä—à—Ä—É—Ç—ã: –í–∫–ª—é—á–µ–Ω—ã –≥–æ—Ä–æ–¥–∞ –≤ —Ä–∞–¥–∏—É—Å–µ 1000–∫–º –æ—Ç –ú–æ—Å–∫–≤—ã"
        echo "üì¶ –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã: –ö–æ–ª–µ–¥–∏–Ω–æ WB, –ü–æ–¥–æ–ª—å—Å–∫, –ë–µ–ª—ã–µ –°—Ç–æ–ª–±—ã, –≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å, –¢–≤–µ—Ä—å Ozon"
        echo "üè≠ –ü—Ä–æ–º–∑–æ–Ω—ã: –¢—É–ª–∞ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è"
        echo "üéØ –í—Å–µ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π: 25+ –≥–æ—Ä–æ–¥–æ–≤"
        echo "‚ö° –†–µ–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ OpenRouteService API"
        echo "üöÄ –°—Ç—Ä–∞–Ω–∏—Ü—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –¥–µ–ø–ª–æ—é"
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä