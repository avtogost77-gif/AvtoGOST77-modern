name: SEO Pages Auto-Generator

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞
    - cron: '0 */6 * * *'
  workflow_dispatch:
    inputs:
      pages_count:
        description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'
        required: false
        default: '50'
      strategy:
        description: '–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'
        required: false
        default: 'routes'
        type: choice
        options:
        - routes
        - routes-extended
        - industries
        - calculators

jobs:
  generate-seo-pages:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: read
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install dependencies
      run: |
        npm install fs-extra axios --no-package-lock --no-save
        echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

    - name: Generate SEO Pages
      run: |
        PAGES_COUNT="${{ github.event.inputs.pages_count || '50' }}"
        STRATEGY="${{ github.event.inputs.strategy || 'routes' }}"
        
        echo "üöÄ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º $PAGES_COUNT —Å—Ç—Ä–∞–Ω–∏—Ü —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π: $STRATEGY"
        
        case $STRATEGY in
          "routes")
            node .github/scripts/generate-routes.js $PAGES_COUNT
            ;;
          "routes-extended")
            node .github/scripts/generate-routes-extended.js $PAGES_COUNT
            ;;
          "calculators")
            node .github/scripts/generate-calculators.js $PAGES_COUNT
            ;;
          "industries")
            node .github/scripts/generate-industries.js $PAGES_COUNT
            ;;
          *)
            echo "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: $STRATEGY"
            exit 1
            ;;
        esac

    - name: Update Sitemap
      run: |
        echo "üó∫Ô∏è –û–±–Ω–æ–≤–ª—è–µ–º sitemap.xml..."
        node .github/scripts/update-sitemap.js

    - name: Commit and Push Changes
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
        git add routes/ calculators/ industries/ sitemap.xml
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if git diff --staged --quiet; then
          echo "üìù –ù–µ—Ç –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
        else
          PAGES_COUNT="${{ github.event.inputs.pages_count || '50' }}"
          STRATEGY="${{ github.event.inputs.strategy || 'routes' }}"
          
          git commit -m "ü§ñ AUTO-SEO: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ $PAGES_COUNT —Å—Ç—Ä–∞–Ω–∏—Ü ($STRATEGY)

          ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—è: $STRATEGY
          üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: $PAGES_COUNT —Å—Ç—Ä–∞–Ω–∏—Ü
          üó∫Ô∏è Sitemap –æ–±–Ω–æ–≤–ª–µ–Ω
          üïê $(date '+%Y-%m-%d %H:%M:%S')"
          
          git push origin main
          
          echo "üéâ –°—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!"
        fi

    - name: Summary
      run: |
        echo "üìä –†–ï–ó–£–õ–¨–¢–ê–¢ –ì–ï–ù–ï–†–ê–¶–ò–ò:"
        echo "–°—Ç—Ä–∞—Ç–µ–≥–∏—è: ${{ github.event.inputs.strategy || 'routes' }}"
        echo "–°—Ç—Ä–∞–Ω–∏—Ü: ${{ github.event.inputs.pages_count || '50' }}"
        echo "–í—Ä–µ–º—è: $(date '+%Y-%m-%d %H:%M:%S')"
        
        # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã
        ROUTES_COUNT=$(find routes/ -name "*.html" 2>/dev/null | wc -l || echo "0")
        CALC_COUNT=$(find calculators/ -name "*.html" 2>/dev/null | wc -l || echo "0")
        IND_COUNT=$(find industries/ -name "*.html" 2>/dev/null | wc -l || echo "0")
        
        echo "üìÑ –í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:"
        echo "  –ú–∞—Ä—à—Ä—É—Ç—ã: $ROUTES_COUNT"
        echo "  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã: $CALC_COUNT"  
        echo "  –û—Ç—Ä–∞—Å–ª–∏: $IND_COUNT"
        echo "  –ò–¢–û–ì–û: $((ROUTES_COUNT + CALC_COUNT + IND_COUNT))"