#!/bin/bash

# –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–µ–π–∫–æ–≤—ã—Ö aggregateRating

echo "üö® –≠–ö–°–¢–†–ï–ù–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –§–ï–ô–ö–û–í–´–• –†–ï–ô–¢–ò–ù–ì–û–í"
echo "=============================================="

# –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø
echo "üì¶ –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø..."
mkdir -p backup-rating-fix-$(date +%Y%m%d-%H%M%S)
cp *.html backup-rating-fix-$(date +%Y%m%d-%H%M%S)/

echo "üîß –£–¥–∞–ª—è–µ–º aggregateRating –±–ª–æ–∫–∏..."

# –£–¥–∞–ª—è–µ–º –≤—Å–µ aggregateRating –±–ª–æ–∫–∏ –∏–∑ –≤—Å–µ—Ö HTML —Ñ–∞–π–ª–æ–≤
find . -maxdepth 1 -name "*.html" -not -path "./backup*" -not -name "test*" | while read file; do
    echo "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º: $file"
    
    # –£–¥–∞–ª—è–µ–º aggregateRating –±–ª–æ–∫–∏ (–≤–∫–ª—é—á–∞—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ)
    sed -i '/aggregateRating/,/},/d' "$file"
    
    # –¢–∞–∫–∂–µ —É–¥–∞–ª—è–µ–º –æ–¥–∏–Ω–æ—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å aggregateRating
    sed -i '/aggregateRating/d' "$file"
    
    # –û—á–∏—â–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –ª–∏—à–Ω–∏–µ –∑–∞–ø—è—Ç—ã–µ
    sed -i '/^[[:space:]]*$/d' "$file"
    sed -i 's/,[[:space:]]*,/,/g' "$file"
    sed -i 's/,[[:space:]]*}/}/g' "$file"
    
done

echo "‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!"
echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç..."
remaining=$(grep -r "aggregateRating" . --include="*.html" | wc -l)
echo "–û—Å—Ç–∞–ª–æ—Å—å aggregateRating –±–ª–æ–∫–æ–≤: $remaining"

if [ $remaining -eq 0 ]; then
    echo "üéâ –í–°–ï –§–ï–ô–ö–û–í–´–ï –†–ï–ô–¢–ò–ù–ì–ò –£–î–ê–õ–ï–ù–´!"
else
    echo "‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞..."
fi

echo ""
echo "üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
echo "1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –≤—Ä—É—á–Ω—É—é"  
echo "2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä"
echo "3. –ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é"
echo "4. Google –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Å—Ç–∏—Ç—å —Ñ–µ–π–∫–æ–≤—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏"


