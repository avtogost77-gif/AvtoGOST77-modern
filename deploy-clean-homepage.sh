#!/bin/bash

echo "üöÄ –î–ï–ü–õ–û–ô –ß–ò–°–¢–û–ô –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´"
echo "=================================="
echo "üìä –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–ª–∞–≤–Ω—É—é –±–µ–∑ –ø—Ä–æ—Å—Ç—ã–Ω–∏: 1966 —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ 2419 (-18.7%)"

VPS_HOST="root@193.160.208.183"
VPS_PATH="/www/wwwroot/avtogost77.ru"
SSH_KEY="$HOME/.ssh/id_ed25519"

if [ ! -f "$SSH_KEY" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: SSH –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω: $SSH_KEY"
    exit 1
fi
echo "‚úÖ SSH –∫–ª—é—á –Ω–∞–π–¥–µ–Ω: $SSH_KEY"

# –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –Ω–∞ VPS
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ VPS..."
ssh -i $SSH_KEY $VPS_HOST "cp $VPS_PATH/index.html $VPS_PATH/index.html.backup-before-cleanup-\$(date +%Y%m%d-%H%M%S) 2>/dev/null || true"

# –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—á–∏—â–µ–Ω–Ω—É—é –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
echo "üóëÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –û–ß–ò–©–ï–ù–ù–£–Æ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É..."
scp -i $SSH_KEY index.html $VPS_HOST:$VPS_PATH/

# –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç—á–µ—Ç –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
echo "üìã –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç—á–µ—Ç –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏..."
scp -i $SSH_KEY homepage-cleanup-report.md $VPS_HOST:$VPS_PATH/

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
echo "üîí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞..."
ssh -i $SSH_KEY $VPS_HOST "chown www-data:www-data $VPS_PATH/index.html"
ssh -i $SSH_KEY $VPS_HOST "chmod 644 $VPS_PATH/index.html"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º nginx
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ nginx..."
ssh -i $SSH_KEY $VPS_HOST "systemctl restart nginx"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
ssh -i $SSH_KEY $VPS_HOST "systemctl status nginx --no-pager | head -5"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
echo ""
echo "üéâ –î–ï–ü–õ–û–ô –ó–ê–í–ï–†–®–ï–ù!"
echo "==================="
echo "‚ú® –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞:"
echo "üìä –ë—ã–ª–æ: 2419 —Å—Ç—Ä–æ–∫ (–ø—Ä–æ—Å—Ç—ã–Ω—è)"
echo "üìä –°—Ç–∞–ª–æ: 1966 —Å—Ç—Ä–æ–∫ (–∫–æ–º–ø–∞–∫—Ç–Ω–æ)"
echo "üìà –≠–∫–æ–Ω–æ–º–∏—è: 453 —Å—Ç—Ä–æ–∫–∏ (-18.7%)"
echo ""
echo "üóëÔ∏è –£–î–ê–õ–ï–ù–û:"
echo "  ‚Ä¢ –î—É–±–ª–∏—Ä—É—é—â–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (-272 —Å—Ç—Ä–æ–∫–∏)"
echo "  ‚Ä¢ –ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π FAQ (-53 —Å—Ç—Ä–æ–∫–∏)"
echo "  ‚Ä¢ –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –±–ª–æ–∫–∏ '–û –∫–æ–º–ø–∞–Ω–∏–∏' (-69 —Å—Ç—Ä–æ–∫)"
echo "  ‚Ä¢ –î–ª–∏–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã ‚Üí 3 –∫–æ—Ä–æ—Ç–∫–∏—Ö (-59 —Å—Ç—Ä–æ–∫)"
echo ""
echo "üéØ –†–ï–ó–£–õ–¨–¢–ê–¢:"
echo "  ‚Ä¢ –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç—è—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"
echo "  ‚Ä¢ –§–æ–∫—É—Å –Ω–∞ –≥–ª–∞–≤–Ω–æ–º"
echo "  ‚Ä¢ –ì–æ—Ç–æ–≤–∞ –∫ +15% –∫–æ–Ω–≤–µ—Ä—Å–∏–∏"
echo ""
echo "üåê –°–∞–π—Ç: https://avtogost77.ru"
echo "üî• –ü–†–û–°–¢–´–ù–Ø –õ–ò–ö–í–ò–î–ò–†–û–í–ê–ù–ê –ù–ê –ü–†–û–î–ê–ö–®–ù–ï!"


