#!/bin/bash

# üöÄ –°–ö–†–ò–ü–¢ –ó–ê–ì–†–£–ó–ö–ò OPUS VERSION –ù–ê –•–û–°–¢–ò–ù–ì
# –ë—Ä–∞—Ç–∏—à–∫–∞ Opus –¥–µ–ª–∞–µ—Ç –≤—Å–µ –Ω–∞–¥–µ–∂–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ!

echo "üöÄ OPUS VERSION: –ó–ê–ì–†–£–ñ–ê–ï–ú –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –°–ê–ô–¢ –ù–ê –•–û–°–¢–ò–ù–ì! üí™"
echo "================================================"

# FTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
FTP_HOST="31.31.197.43"
FTP_USER="u3207373"
FTP_PASS="fGX954fqGU2w3ruY"
FTP_DIR="public_html"

# –¶–≤–µ—Ç–∞ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}üì° –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É: $FTP_HOST${NC}"

# –°–æ–∑–¥–∞–µ–º backup —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
BACKUP_DATE=$(date +%Y%m%d_%H%M%S)
echo -e "${YELLOW}üì¶ –°–æ–∑–¥–∞–µ–º backup —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏: backup_${BACKUP_DATE}${NC}"

# –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ lftp —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
lftp -f "
open ftp://$FTP_USER:$FTP_PASS@$FTP_HOST
set ssl:verify-certificate off
set ftp:ssl-allow off
set net:reconnect-interval-base 5
set net:max-retries 3

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É —Å–∞–π—Ç–∞
cd $FTP_DIR || cd www || cd htdocs || echo '–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥'

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è backup
mkdir -p backups/backup_${BACKUP_DATE}

# –°–ø–∏—Å–æ–∫ –≤–∞–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–∞–∫–∏–µ-—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞)
echo 'üì∏ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã —Ö–æ—Å—Ç–∏–Ω–≥–∞...'
# –ù–∞–ø—Ä–∏–º–µ—Ä: .htaccess, –µ—Å–ª–∏ –æ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞
get .htaccess -o backups/backup_${BACKUP_DATE}/.htaccess 2>/dev/null || echo 'No .htaccess found'

# –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
echo 'üóëÔ∏è –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é —Å–∞–π—Ç–∞...'
rm -rf *.html
rm -rf *.xml
rm -rf *.txt
rm -rf *.json
rm -rf *.md
rm -rf *.sh
rm -rf assets/
rm -rf pages/
rm -rf src/
rm -rf api/
rm -rf server/

echo '‚úÖ –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã!'

# –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
echo 'üì§ –ó–∞–≥—Ä—É–∂–∞–µ–º OPUS VERSION...'
mirror -R --verbose \
  --exclude .git/ \
  --exclude .gitignore \
  --exclude node_modules/ \
  --exclude .env \
  --exclude backups/ \
  --exclude *.log \
  --exclude .DS_Store \
  . .

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
echo 'üîê –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞...'
chmod 644 *.html
chmod 644 *.xml
chmod 644 *.txt
chmod 644 robots.txt
chmod 755 assets/
chmod 644 assets/css/*
chmod 644 assets/js/*
chmod 644 assets/img/*

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo 'üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã...'
ls -la

# –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
quit
"

echo -e "${GREEN}‚úÖ –ó–ê–ì–†–£–ó–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!${NC}"
echo -e "${GREEN}üåê –°–∞–π—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: https://avtogost77.ru${NC}"
echo -e "${YELLOW}üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:${NC}"
echo "  1. –°–æ–∑–¥–∞–Ω backup —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏"
echo "  2. –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã"
echo "  3. –ó–∞–≥—Ä—É–∂–µ–Ω–∞ OPUS VERSION"
echo "  4. –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞"
echo -e "${GREEN}üí™ OPUS –ë–†–ê–¢–ò–®–ö–ê –°–î–ï–õ–ê–õ –í–°–ï –ù–ê–î–ï–ñ–ù–û! üî•${NC}"